# 🖥️ Настройка компьютера с весами для облачного доступа

## 🎯 Цель
Настроить компьютер с весами так, чтобы водители могли подключаться к весам через мобильный интернет из любой точки.

## 📋 Что нужно установить на компьютере с весами

### 1. Локальный сервер весов (уже работает)
- **Файл**: `scales-http-server.js`
- **Порт**: 8080
- **Подключение**: COM3 к весам
- **Статус**: ✅ Уже настроен

### 2. Облачный сервер (нужно добавить)
- **Файл**: `scales-cloud-server.js`
- **Порт**: 3001
- **Функция**: Промежуточный сервер для мобильного доступа

## 🚀 Быстрая установка облачного сервера

### Шаг 1: Скопируйте файлы
```bash
# Скопируйте эти файлы на компьютер с весами:
# - scales-cloud-server.js
# - cloud-server-package.json
```

### Шаг 2: Установите зависимости
```bash
# Переименуйте файл
mv cloud-server-package.json package.json

# Установите зависимости
npm install
```

### Шаг 3: Настройте переменные окружения
```bash
# Создайте .env файл
cat > .env << EOF
PORT=3001
LOCAL_SCALES_URL=http://localhost:8080
NODE_ENV=production
EOF
```

### Шаг 4: Запустите сервер
```bash
# Обычный запуск
npm start

# Или с автозапуском (рекомендуется)
npm install -g pm2
pm2 start scales-cloud-server.js --name scales-cloud
pm2 startup
pm2 save
```

## 🌐 Настройка сетевого доступа

### Вариант 1: Локальный сервер с внешним IP
1. **Настройте статический IP** для компьютера с весами
2. **Откройте порты** на роутере:
   - 3001 (облачный сервер)
   - 8080 (локальный сервер, опционально)
3. **Водители подключаются** к `http://ВАШ_IP:3001`

### Вариант 2: Облачный хостинг (рекомендуется)
1. **Арендуйте VPS** (от 300₽/месяц)
2. **Настройте облачный сервер** на VPS
3. **Укажите IP компьютера с весами** в настройках
4. **Водители подключаются** к `https://your-domain.com:3001`

## 🔧 Настройка компьютера с весами для облачного доступа

### Обновите локальный сервер весов
```javascript
// В scales-http-server.js добавьте CORS для облачного сервера
app.use(cors({
  origin: [
    'http://localhost:3000', 
    'http://localhost:3001',
    'https://your-cloud-server.com'
  ],
  credentials: true
}));
```

### Убедитесь в доступности
```bash
# Проверьте, что локальный сервер работает
curl http://localhost:8080/status

# Проверьте, что облачный сервер работает
curl http://localhost:3001/cloud/status
```

## 📱 Для водителей

### Автоматическое подключение
Водители просто:
1. **Открывают приложение** на мобильном телефоне
2. **Подключаются к интернету** (Wi-Fi или мобильный)
3. **Приложение автоматически** определяет способ подключения:
   - Если рядом со складом - использует Wi-Fi
   - Если далеко от склада - использует облачный сервер

### Адреса для подключения
- **Wi-Fi (рядом со складом)**: `http://192.168.1.100:3000`
- **Мобильный интернет (далеко от склада)**: `https://your-cloud-server.com:3000`

## ✅ Проверка работы

### На компьютере с весами:
```bash
# Проверьте статус локального сервера
curl http://localhost:8080/status

# Проверьте статус облачного сервера
curl http://localhost:3001/cloud/status

# Проверьте получение веса
curl http://localhost:3001/cloud/weight
```

### На мобильном устройстве водителя:
1. Откройте приложение
2. Перейдите в "⚖️ Взвешивание"
3. Проверьте статус подключения
4. Попробуйте получить вес

## 🔒 Безопасность

### SSL сертификат (для облачного сервера)
```bash
# Установите Certbot
sudo apt install certbot

# Получите сертификат
sudo certbot certonly --standalone -d your-domain.com

# Настройте автообновление
sudo crontab -e
# Добавьте: 0 12 * * * /usr/bin/certbot renew --quiet
```

### Брандмауэр
```bash
# Откройте только необходимые порты
sudo ufw allow 3001
sudo ufw allow 8080
sudo ufw enable
```

## 📊 Мониторинг

### PM2 мониторинг
```bash
# Просмотр логов
pm2 logs scales-cloud

# Мониторинг в реальном времени
pm2 monit

# Перезапуск при необходимости
pm2 restart scales-cloud
```

### Проверка подключений
```bash
# Количество подключенных клиентов
curl http://localhost:3001/cloud/status | grep connected_clients

# Статус локального сервера
curl http://localhost:3001/cloud/status | grep local_server_status
```

## 🎯 Результат

После настройки:
- ✅ **Компьютер с весами** работает как обычно
- ✅ **Облачный сервер** обеспечивает удаленный доступ
- ✅ **Водители** могут взвешиваться из любой точки
- ✅ **Автоматическое переключение** между Wi-Fi и мобильным интернетом
- ✅ **Безопасность** через SSL шифрование

## 🚨 Устранение неполадок

### Если водители не могут подключиться:
1. Проверьте статус серверов: `pm2 status`
2. Проверьте логи: `pm2 logs scales-cloud`
3. Проверьте сетевую доступность: `ping your-server`
4. Проверьте порты: `netstat -tlnp | grep :3001`

### Если весы не отвечают:
1. Проверьте COM3 подключение
2. Проверьте локальный сервер: `curl http://localhost:8080/status`
3. Перезапустите локальный сервер
4. Проверьте настройки весов

---

**Итог**: Компьютер с весами остается на месте и работает как обычно, но теперь водители могут подключаться к нему удаленно через мобильный интернет! 🚛📱⚖️
