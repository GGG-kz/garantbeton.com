import{j as e,c as s,a as t,P as a}from"./index-DssK2aQr.js";import{r as l}from"./vendor-CPG67Noa.js";import{M as o}from"./Modal-_SIwUgx5.js";import{b as n,z as r,K as i,ac as m,R as c,U as d,Q as x,O as h,a as p,V as u,i as j,u as g,k as N,T as f}from"./ui-DT0cN5GG.js";import"./utils-CHM7ATol.js";import"./forms-BH-hazHY.js";function b({isOpen:t,onClose:a,onSave:o,driver:d,title:x}){const[h,p]=l.useState({name:"",fullName:"",phone:"",login:"",vehicleIds:[],tempPassword:"",hasChangedPassword:!1}),[u,j]=l.useState({}),g=()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let s="";for(let t=0;t<8;t++)s+=e.charAt(Math.floor(62*Math.random()));return s};l.useEffect(()=>{p(d?{name:d.name,fullName:d.fullName,phone:d.phone,login:d.login,vehicleIds:d.vehicleIds,tempPassword:d.tempPassword||"",hasChangedPassword:d.hasChangedPassword||!1}:{name:"",fullName:"",phone:"",login:"",vehicleIds:[],tempPassword:g(),hasChangedPassword:!1}),j({})},[d,t]);const N=(e,s)=>{p(t=>{const a={...t,[e]:s};if("phone"===e){const e=String(s).replace(/\D/g,"");e.startsWith("7")&&11===e.length?a.login="8"+e.substring(1):(e.startsWith("8")&&e.length,a.login=e)}return a}),u[e]&&j(s=>({...s,[e]:""}))};return e.jsx("div",{className:"space-y-6",children:e.jsxs("form",{onSubmit:async e=>{e.preventDefault();const t={};if(h.fullName.trim()||(t.fullName="ФИО обязательно"),h.phone.trim()||(t.phone="Телефон обязателен"),h.login.trim()?/^8\d{10}$/.test(h.login)||(t.login="Логин должен быть в формате 8XXXXXXXXXX"):t.login="Логин обязателен",Object.keys(t).length>0)j(t);else try{if(!d){const e={id:Date.now().toString(),login:h.login,tempPassword:h.tempPassword,fullName:h.fullName,status:"active"};await s.registerDriver(e)}o(h),a()}catch(l){const e=l.response?.data?.message||l.response?.data?.error||"Ошибка при регистрации водителя";j({submit:e})}},className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-mono-700 mb-2",children:"Имя (краткое) *"}),e.jsx("input",{type:"text",id:"name",value:h.name,onChange:e=>N("name",e.target.value),className:"w-full px-4 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"И.И. Иванов"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fullName",className:"block text-sm font-medium text-mono-700 mb-2",children:"ФИО *"}),e.jsxs("div",{className:"relative",children:[e.jsx(n,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-mono-400"}),e.jsx("input",{type:"text",id:"fullName",value:h.fullName,onChange:e=>N("fullName",e.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 "+(u.fullName?"border-red-300":"border-mono-300"),placeholder:"Иванов Иван Иванович"})]}),u.fullName&&e.jsx("p",{className:"mt-1 text-sm text-mono-600",children:u.fullName})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-mono-700 mb-2",children:"Телефон *"}),e.jsxs("div",{className:"relative",children:[e.jsx(r,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-mono-400"}),e.jsx("input",{type:"tel",id:"phone",value:h.phone,onChange:e=>N("phone",e.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 "+(u.phone?"border-red-300":"border-mono-300"),placeholder:"+7 (XXX) XXX-XX-XX"})]}),u.phone&&e.jsx("p",{className:"mt-1 text-sm text-mono-600",children:u.phone})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"login",className:"block text-sm font-medium text-mono-700 mb-2",children:"Логин (номер телефона) *"}),e.jsxs("div",{className:"relative",children:[e.jsx(r,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-mono-400"}),e.jsx("input",{type:"text",id:"login",value:h.login,onChange:e=>N("login",e.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 "+(u.login?"border-red-300":"border-mono-300"),placeholder:"8XXXXXXXXXX"})]}),e.jsx("p",{className:"mt-1 text-xs text-mono-500",children:"Автоматически заполняется на основе номера телефона"}),u.login&&e.jsx("p",{className:"mt-1 text-sm text-mono-600",children:u.login})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tempPassword",className:"block text-sm font-medium text-mono-700 mb-2",children:"Пароль разовый *"}),e.jsxs("div",{className:"relative",children:[e.jsx(i,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-mono-400"}),e.jsx("input",{type:"text",id:"tempPassword",value:h.tempPassword,onChange:e=>N("tempPassword",e.target.value),className:"w-full pl-10 pr-20 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Автоматически сгенерированный пароль",readOnly:!0}),e.jsxs("div",{className:"absolute right-1 top-1/2 transform -translate-y-1/2 flex space-x-1",children:[e.jsx("button",{type:"button",onClick:async()=>{try{await navigator.clipboard.writeText(h.tempPassword)}catch(e){}},className:"p-1 text-mono-400 hover:text-mono-600 transition-colors duration-200",title:"Копировать пароль",children:e.jsx(m,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>{p(e=>({...e,tempPassword:g(),hasChangedPassword:!1}))},className:"p-1 text-mono-400 hover:text-mono-600 transition-colors duration-200",title:"Сгенерировать новый пароль",children:e.jsx(c,{className:"h-4 w-4"})})]})]}),e.jsx("p",{className:"mt-1 text-xs text-mono-500",children:"Водитель сможет изменить этот пароль на постоянный в своем кабинете"})]}),u.submit&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-mono-600",children:u.submit})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t border-mono-200",children:[e.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 text-sm font-medium text-mono-700 bg-mono-100 hover:bg-mono-200 rounded-lg transition-colors duration-200",children:"Отмена"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors duration-200",children:"Сохранить"})]})]})})}const v=[];function w(){const[s,n]=t("drivers",v),[m,c]=l.useState(""),[w,y]=l.useState("all"),[C,X]=l.useState(!1),[k,P]=l.useState(null),[S,I]=l.useState(null),O=s.filter(e=>{const s=e.fullName.toLowerCase().includes(m.toLowerCase())||e.phone.toLowerCase().includes(m.toLowerCase())||e.login.toLowerCase().includes(m.toLowerCase()),t="all"===w||e.status===w;return s&&t&&e.isActive}),D=e=>({active:"Активен",inactive:"Неактивен",vacation:"В отпуске",sick:"На больничном"}[e]),A=()=>{X(!1),P(null)};return e.jsxs(a,{title:"Водители",subtitle:"Управление персоналом водителей и их транспортом",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(d,{className:"h-8 w-8 text-primary-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-mono-900",children:"Водители"}),e.jsxs("p",{className:"text-mono-600",children:["Всего: ",O.length]})]})]}),e.jsxs("button",{onClick:()=>{P(null),X(!0)},className:"flex items-center space-x-2 px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-lg transition-colors duration-200",children:[e.jsx(x,{className:"h-4 w-4"}),e.jsx("span",{children:"Добавить водителя"})]})]}),e.jsx("div",{className:"bg-white rounded-lg border border-mono-200 p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(h,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-mono-400"}),e.jsx("input",{type:"text",placeholder:"Поиск по ФИО, номеру удостоверения или телефону...",value:m,onChange:e=>c(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>y("all"),className:"px-4 py-2 rounded-lg transition-colors duration-200 "+("all"===w?"bg-primary-500 text-white":"bg-mono-100 text-mono-700 hover:bg-mono-200"),children:"Все"}),["active","vacation","sick","inactive"].map(s=>e.jsx("button",{onClick:()=>y(s),className:"px-4 py-2 rounded-lg transition-colors duration-200 "+(w===s?"bg-primary-500 text-white":"bg-mono-100 text-mono-700 hover:bg-mono-200"),children:D(s)},s))]})]})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:O.map(s=>{return e.jsxs("div",{className:"bg-white rounded-lg border border-mono-200 p-6 hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-mono-900",children:s.fullName}),e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${t=s.status,{active:"bg-mono-100 text-green-800",inactive:"bg-mono-100 text-mono-800",vacation:"bg-mono-100 text-black",sick:"bg-red-100 text-red-800"}[t]}`,children:D(s.status)})]})}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:()=>(e=>{I(e)})(s),className:"p-1 text-mono-400 hover:text-mono-600 transition-colors duration-200",title:"Просмотр",children:e.jsx(p,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>(e=>{P(e),X(!0)})(s),className:"p-1 text-mono-400 hover:text-black transition-colors duration-200",title:"Редактировать",children:e.jsx(u,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>{return e=s.id,void(window.confirm("Вы уверены, что хотите удалить этого водителя?")&&n(s=>s.filter(s=>s.id!==e)));var e},className:"p-1 text-mono-400 hover:text-mono-600 transition-colors duration-200",title:"Удалить",children:e.jsx(j,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[s.phone&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-mono-600",children:[e.jsx(r,{className:"h-4 w-4 text-mono-400"}),e.jsx("span",{children:s.phone})]}),s.login&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-mono-600",children:[e.jsx(r,{className:"h-4 w-4 text-mono-400"}),e.jsx("span",{className:"font-mono",children:s.login}),e.jsx("span",{className:"text-xs text-mono-500",children:"(логин)"})]})]}),e.jsx("div",{className:"flex items-center space-x-2 text-sm",children:s.hasChangedPassword?e.jsxs("div",{className:"flex items-center space-x-1 text-mono-600",children:[e.jsx(g,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:"Пароль изменен"})]}):e.jsxs("div",{className:"flex items-center space-x-1 text-orange-600",children:[e.jsx(N,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs",children:"Нужно изменить пароль"})]})})]}),e.jsxs("div",{className:"bg-mono-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(i,{className:"h-4 w-4 text-mono-400"}),e.jsx("span",{className:"text-sm text-mono-600",children:"Временный пароль:"})]}),e.jsx("span",{className:"text-sm font-mono font-medium text-mono-900",children:s.tempPassword})]}),!s.hasChangedPassword&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"⚠️ Водитель должен изменить пароль при первом входе"})]}),s.vehicleIds.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-mono-700 mb-2",children:"Закрепленный транспорт:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.vehicleIds.map((s,t)=>e.jsxs("span",{className:"inline-flex items-center space-x-1 px-2 py-1 text-xs bg-mono-100 text-black rounded",children:[e.jsx(f,{className:"h-3 w-3"}),e.jsx("span",{children:s})]},t))})]}),0===s.vehicleIds.length&&e.jsx("div",{className:"text-center py-2 text-sm text-mono-500 bg-mono-50 rounded",children:"Транспорт не закреплен"})]})]},s.id);var t})}),0===O.length&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(d,{className:"mx-auto h-12 w-12 text-mono-400"}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-mono-900",children:m||"all"!==w?"Водители не найдены":"Нет водителей"}),e.jsx("p",{className:"mt-2 text-mono-600",children:m||"all"!==w?"Попробуйте изменить параметры поиска":"Добавьте первого водителя для начала работы"})]})]}),e.jsx(o,{isOpen:C,onClose:A,title:k?"Редактировать водителя":"Добавить водителя",size:"lg",children:e.jsx(b,{isOpen:C,onClose:A,onSave:e=>{if(k)n(s=>s.map(s=>s.id===k.id?{...s,...e,updatedAt:(new Date).toISOString()}:s));else{const s={id:Date.now().toString(),...e,status:"active",isActive:!0,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};n(e=>[...e,s])}},driver:k,title:k?"Редактировать водителя":"Добавить водителя"})}),e.jsx(o,{isOpen:!!S,onClose:()=>I(null),title:"Просмотр водителя",size:"md",children:S&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-mono-700",children:"ФИО"}),e.jsx("p",{className:"mt-1 text-sm text-mono-900",children:S.fullName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-mono-700",children:"Статус"}),e.jsx("p",{className:"mt-1 text-sm text-mono-900",children:D(S.status)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-mono-700",children:"Телефон"}),e.jsx("p",{className:"mt-1 text-sm text-mono-900",children:S.phone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-mono-700",children:"Логин"}),e.jsx("p",{className:"mt-1 text-sm font-mono text-mono-900",children:S.login})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-mono-700",children:"Статус пароля"}),e.jsx("div",{className:"mt-1 flex items-center space-x-2",children:S.hasChangedPassword?e.jsxs("div",{className:"flex items-center space-x-1 text-mono-600",children:[e.jsx(g,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Пароль изменен"})]}):e.jsxs("div",{className:"flex items-center space-x-1 text-orange-600",children:[e.jsx(N,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Нужно изменить пароль"})]})})]})}),e.jsxs("div",{className:"bg-mono-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(i,{className:"h-4 w-4 text-mono-400"}),e.jsx("label",{className:"block text-sm font-medium text-mono-700",children:"Временный пароль"})]}),e.jsx("span",{className:"text-sm font-mono font-medium text-mono-900 bg-white px-2 py-1 rounded border",children:S.tempPassword})]}),!S.hasChangedPassword&&e.jsx("p",{className:"text-xs text-orange-600",children:"⚠️ Водитель должен изменить этот пароль на постоянный в своем кабинете при первом входе"}),S.hasChangedPassword&&e.jsx("p",{className:"text-xs text-mono-600",children:"✅ Водитель уже изменил пароль на постоянный"})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t border-mono-200",children:e.jsx("button",{onClick:()=>I(null),className:"px-4 py-2 text-sm font-medium text-mono-700 bg-mono-100 hover:bg-mono-200 rounded-lg transition-colors duration-200",children:"Закрыть"})})]})})]})}export{w as default};
