import{a as e,j as t,P as s}from"./index-DssK2aQr.js";import{r as a}from"./vendor-CPG67Noa.js";import{V as i}from"./ViewToggle-BZCXPk9z.js";import{R as r,a as n}from"./ReceiptInvoicePrint-BKjFFOGi.js";import{F as o,Q as l,O as c,Y as d,N as m,a as x,V as h,i as p,Z as u,P as j,ae as g,D as v}from"./ui-DT0cN5GG.js";import"./utils-CHM7ATol.js";import"./forms-BH-hazHY.js";import"./Modal-_SIwUgx5.js";const w=[{id:"invoice-1",invoiceNumber:"ПН-20241201-001",invoiceDate:"2024-12-01",warehouse:"Склад А",seal:"Печать 1",items:[{id:"item-1",vehicleNumber:"01ABC123",supplier:"supplier-1",buyer:"client-1",material:"material-1",weighingStatus:"completed"}],receivedBy:"driver1",issuedBy:"Поставщик 1",status:"completed",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),createdBy:"driver1",isActive:!0},{id:"invoice-2",invoiceNumber:"ПН-20241201-002",invoiceDate:"2024-12-01",warehouse:"Склад Б",seal:"Печать 2",items:[{id:"item-2",vehicleNumber:"02DEF456",supplier:"supplier-2",buyer:"client-2",material:"material-2",weighingStatus:"pending"}],receivedBy:"driver2",issuedBy:"Поставщик 2",status:"draft",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),createdBy:"driver2",isActive:!0}];function N(){const[N,b]=e("receiptInvoices",w),[f]=e("counterparties",[]),[y,k]=e("receiptInvoicesViewMode","list"),[D,S]=a.useState(""),[C,A]=a.useState(""),[I,L]=a.useState(""),[B,M]=a.useState(!1),[O,P]=a.useState(!1),[F,V]=a.useState(null),[T,z]=a.useState(null),[R,Z]=a.useState(!1),$=a.useMemo(()=>{let e=N.filter(e=>e.isActive);return D&&(e=e.filter(e=>{const t=e.items.length>0&&f.find(t=>t.id===e.items[0].supplier)?.name||"";return e.invoiceNumber.toLowerCase().includes(D.toLowerCase())||t.toLowerCase().includes(D.toLowerCase())||e.warehouse.toLowerCase().includes(D.toLowerCase())})),C&&(e=e.filter(e=>new Date(e.invoiceDate)>=new Date(C))),I&&(e=e.filter(e=>new Date(e.invoiceDate)<=new Date(I))),e.sort((e,t)=>new Date(t.invoiceDate).getTime()-new Date(e.invoiceDate).getTime())},[N,D,C,I]),E=e=>{V(e),P(!0)},K=e=>{z(e),Z(!0)},Q=e=>{window.confirm("Вы уверены, что хотите удалить эту приходную накладную?")&&b(t=>t.map(t=>t.id===e?{...t,isActive:!1}:t))},W=()=>{alert("Экспорт в PDF будет реализован")},Y=e=>{switch(e){case"pending":return"Ожидает";case"received":return"Принята";case"completed":return"Завершена";default:return e}},_=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"received":return"bg-mono-100 text-black";case"completed":return"bg-mono-100 text-green-800";default:return"bg-mono-100 text-mono-800"}},q=e=>new Date(e).toLocaleDateString("kk-KZ");return t.jsx(s,{title:"Приходные накладные",subtitle:"Управление поступлением товаров и материалов",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx(o,{className:"h-8 w-8 text-primary-600"}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-mono-900",children:"Приходные накладные"}),t.jsxs("p",{className:"text-mono-600",children:["Всего: ",$.length]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(i,{viewMode:y,onViewModeChange:k}),t.jsxs("button",{onClick:()=>{V(null),P(!0)},className:"flex items-center space-x-2 px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-lg transition-colors duration-200",children:[t.jsx(l,{className:"h-4 w-4"}),t.jsx("span",{children:"Создать накладную"})]})]})]}),t.jsxs("div",{className:"bg-white rounded-lg border border-mono-200 p-4",children:[t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-mono-400"}),t.jsx("input",{type:"text",placeholder:"Поиск по номеру, поставщику, складу...",value:D,onChange:e=>S(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})}),t.jsxs("button",{onClick:()=>M(!B),className:"flex items-center space-x-2 px-4 py-2 border border-mono-300 rounded-lg hover:bg-mono-50 transition-colors duration-200",children:[t.jsx(d,{className:"h-4 w-4"}),t.jsx("span",{children:"Фильтры"})]})]}),B&&t.jsx("div",{className:"mt-4 pt-4 border-t border-mono-200",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-mono-700 mb-1",children:"Дата с"}),t.jsxs("div",{className:"relative",children:[t.jsx(m,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-mono-400"}),t.jsx("input",{type:"date",value:C,onChange:e=>A(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-mono-700 mb-1",children:"Дата по"}),t.jsxs("div",{className:"relative",children:[t.jsx(m,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-mono-400"}),t.jsx("input",{type:"date",value:I,onChange:e=>L(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})]})]})})]}),"list"===y?t.jsx("div",{className:"bg-white rounded-lg border border-mono-200 overflow-hidden",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-mono-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Номер"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Дата"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Поставщик"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Склад"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Статус"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Действия"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:$.map(e=>t.jsxs("tr",{className:"hover:bg-mono-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm font-medium text-mono-900",children:e.invoiceNumber})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-mono-900",children:q(e.invoiceDate)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-mono-900",children:e.items.length>0?f.find(t=>t.id===e.items[0].supplier)?.name||"Неизвестный поставщик":"Нет поставщика"}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-mono-900",children:e.warehouse}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${_(e.status)}`,children:Y(e.status)})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex justify-end space-x-2",children:[t.jsx("button",{onClick:()=>K(e),className:"text-black hover:text-black",title:"Просмотр",children:t.jsx(x,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>E(e),className:"text-indigo-600 hover:text-indigo-900",title:"Редактировать",children:t.jsx(h,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>Q(e.id),className:"text-mono-600 hover:text-red-900",title:"Удалить",children:t.jsx(p,{className:"h-4 w-4"})})]})})]},e.id))})]})})}):t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:$.map(e=>t.jsxs("div",{className:"bg-white rounded-lg border border-mono-200 p-6 hover:shadow-lg transition-shadow duration-200 relative",children:[t.jsxs("div",{className:"absolute top-4 right-4 flex items-center gap-1",children:[t.jsx("button",{onClick:()=>K(e),className:"p-1 text-black hover:text-black rounded hover:bg-mono-50 transition-colors duration-200",title:"Просмотр",children:t.jsx(x,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>E(e),className:"p-1 text-indigo-600 hover:text-indigo-900 rounded hover:bg-indigo-50 transition-colors duration-200",title:"Редактировать",children:t.jsx(h,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>Q(e.id),className:"p-1 text-mono-600 hover:text-red-900 rounded hover:bg-red-50 transition-colors duration-200",title:"Удалить",children:t.jsx(p,{className:"h-4 w-4"})})]}),t.jsxs("div",{className:"mb-4 pr-20",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("h3",{className:"text-lg font-semibold text-mono-900 truncate",children:e.invoiceNumber}),t.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full whitespace-nowrap ${_(e.status)}`,children:Y(e.status)})]}),t.jsx("p",{className:"text-sm text-mono-600",children:q(e.invoiceDate)})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center text-sm text-mono-600",children:[t.jsx(u,{className:"h-4 w-4 text-mono-400 mr-2"}),t.jsx("span",{className:"truncate",children:e.items.length>0?f.find(t=>t.id===e.items[0].supplier)?.name||"Неизвестный поставщик":"Нет поставщика"})]}),t.jsxs("div",{className:"flex items-center text-sm text-mono-600",children:[t.jsx(j,{className:"h-4 w-4 text-mono-400 mr-2"}),t.jsx("span",{className:"truncate",children:e.warehouse})]}),t.jsxs("div",{className:"flex items-center text-sm text-mono-600",children:[t.jsx(o,{className:"h-4 w-4 text-mono-400 mr-2"}),t.jsxs("span",{children:[e.items.length," товар(ов)"]})]})]}),t.jsxs("div",{className:"mt-4 pt-4 border-t border-mono-200 flex justify-between",children:[t.jsxs("button",{onClick:()=>K(e),className:"flex items-center space-x-1 px-3 py-1 text-black hover:text-black transition-colors duration-200",children:[t.jsx(g,{className:"h-4 w-4"}),t.jsx("span",{className:"text-sm",children:"Печать"})]}),t.jsxs("button",{onClick:()=>W(),className:"flex items-center space-x-1 px-3 py-1 text-mono-600 hover:text-green-800 transition-colors duration-200",children:[t.jsx(v,{className:"h-4 w-4"}),t.jsx("span",{className:"text-sm",children:"PDF"})]})]})]},e.id))}),0===$.length&&t.jsxs("div",{className:"text-center py-12",children:[t.jsx(o,{className:"mx-auto h-12 w-12 text-mono-400"}),t.jsx("h3",{className:"mt-4 text-lg font-medium text-mono-900",children:D||C||I?"Накладные не найдены":"Нет приходных накладных"}),t.jsx("p",{className:"mt-2 text-mono-600",children:D||C||I?"Попробуйте изменить параметры поиска":"Создайте первую приходную накладную для начала работы"})]}),t.jsx(r,{isOpen:O,onClose:()=>{P(!1),V(null)},title:F?"Редактировать приходную накладную":"Создать приходную накладную",invoice:F,onSave:e=>{if(F)b(t=>t.map(t=>t.id===F.id?{...t,...e,items:e.items.map(e=>({...e,id:e.id||Date.now().toString()+Math.random().toString(36).substr(2,9)})),updatedAt:(new Date).toISOString()}:t));else{const t={id:Date.now().toString(),...e,items:e.items.map(e=>({...e,id:e.id||Date.now().toString()+Math.random().toString(36).substr(2,9)})),status:"draft",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),createdBy:"current_user",isActive:!0};b(e=>[...e,t])}P(!1),V(null)}}),R&&T&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",children:t.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex justify-between items-start mb-4",children:[t.jsxs("h3",{className:"text-xl font-semibold text-mono-900",children:["Приходная накладная ",T.invoiceNumber]}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsxs("button",{onClick:()=>{window.print()},className:"flex items-center space-x-2 px-4 py-2 bg-black text-white rounded-lg hover:bg-black transition-colors duration-200",children:[t.jsx(g,{className:"h-4 w-4"}),t.jsx("span",{children:"В печать"})]}),t.jsxs("button",{onClick:W,className:"flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-200",children:[t.jsx(v,{className:"h-4 w-4"}),t.jsx("span",{children:"PDF"})]}),t.jsx("button",{onClick:()=>Z(!1),className:"text-mono-400 hover:text-mono-600",children:t.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),t.jsx(n,{invoice:T})]})})})]})})}export{N as default};
