import{u as e,a as t,U as s,j as o,P as n}from"./index-DssK2aQr.js";import{r as a}from"./vendor-CPG67Noa.js";import{M as l}from"./Modal-_SIwUgx5.js";import{V as r}from"./ViewToggle-BZCXPk9z.js";import{u as i,U as c,a2 as d,a as m,O as x,Q as u,b as h,v as p,a3 as g,V as j,i as b}from"./ui-DT0cN5GG.js";import"./utils-CHM7ATol.js";import"./forms-BH-hazHY.js";const f=[{id:"1",login:"admin",fullName:"Администратор Системы",email:"admin@beton.com",role:s.ADMIN,isActive:!0,lastLoginAt:new Date(Date.now()-36e5).toISOString(),createdAt:new Date(Date.now()-2592e6).toISOString(),updatedAt:new Date(Date.now()-36e5).toISOString()},{id:"2",login:"manager",fullName:"Иван Петров",email:"manager@beton.com",role:s.MANAGER,isActive:!0,lastLoginAt:new Date(Date.now()-72e5).toISOString(),createdAt:new Date(Date.now()-216e7).toISOString(),updatedAt:new Date(Date.now()-72e5).toISOString()},{id:"3",login:"operator",fullName:"Анна Сидорова",email:"operator@beton.com",role:s.OPERATOR,isActive:!0,lastLoginAt:new Date(Date.now()-108e5).toISOString(),createdAt:new Date(Date.now()-1296e6).toISOString(),updatedAt:new Date(Date.now()-108e5).toISOString()},{id:"4",login:"cook",fullName:"Мария Кузнецова",email:"cook@beton.com",role:s.COOK,isActive:!1,lastLoginAt:new Date(Date.now()-2592e5).toISOString(),createdAt:new Date(Date.now()-864e6).toISOString(),updatedAt:new Date(Date.now()-2592e5).toISOString()},{id:"5",login:"driver1",fullName:"Сергей Волков",email:"driver1@beton.com",role:s.DRIVER,isActive:!0,lastLoginAt:new Date(Date.now()-18e5).toISOString(),createdAt:new Date(Date.now()-1728e6).toISOString(),updatedAt:new Date(Date.now()-18e5).toISOString()}],N=[{id:"1",userId:"2",userName:"Иван Петров",action:"login",resource:"auth",ipAddress:"192.168.1.100",timestamp:new Date(Date.now()-36e5).toISOString()},{id:"2",userId:"2",userName:"Иван Петров",action:"create",resource:"counterparty",resourceId:"123",details:'Создан новый контрагент "ООО Стройка"',timestamp:new Date(Date.now()-35e5).toISOString()},{id:"3",userId:"3",userName:"Анна Сидорова",action:"login",resource:"auth",ipAddress:"192.168.1.101",timestamp:new Date(Date.now()-108e5).toISOString()}],v={[s.DEVELOPER]:"Разработчик",[s.ADMIN]:"Администратор",[s.MANAGER]:"Менеджер",[s.DISPATCHER]:"Диспетчер",[s.DRIVER]:"Водитель",[s.SUPPLY]:"Снабженец",[s.ACCOUNTANT]:"Бухгалтер",[s.DIRECTOR]:"Директор",[s.OPERATOR]:"Оператор",[s.COOK]:"Повар"},w={[s.DEVELOPER]:"text-purple-600 bg-purple-100",[s.ADMIN]:"text-mono-600 bg-red-100",[s.MANAGER]:"text-black bg-mono-100",[s.DISPATCHER]:"text-mono-600 bg-mono-100",[s.DRIVER]:"text-orange-600 bg-orange-100",[s.SUPPLY]:"text-indigo-600 bg-indigo-100",[s.ACCOUNTANT]:"text-emerald-600 bg-emerald-100",[s.DIRECTOR]:"text-mono-600 bg-mono-100",[s.OPERATOR]:"text-indigo-600 bg-indigo-100",[s.COOK]:"text-orange-600 bg-orange-100"};function A(){const{user:l}=e(),[A,D]=t("adminUsers",f),[k,O]=t("userActivityLogs",N),[I,C]=t("usersViewMode","list"),[R,E]=a.useState(!1),[L,M]=a.useState(!1),[P,T]=a.useState(null),[V,U]=a.useState(""),[$,G]=a.useState("all"),[F,_]=a.useState("all");if(!l||l.role!==s.ADMIN)return o.jsx("div",{className:"flex items-center justify-center min-h-screen",children:o.jsxs("div",{className:"text-center",children:[o.jsx(i,{className:"h-16 w-16 text-mono-500 mx-auto mb-4"}),o.jsx("h1",{className:"text-2xl font-bold text-mono-900 mb-4",children:"Доступ запрещен"}),o.jsx("p",{className:"text-mono-600",children:"Только администраторы могут управлять пользователями"})]})});const K=A.filter(e=>{const t=e.login.toLowerCase().includes(V.toLowerCase())||e.fullName?.toLowerCase().includes(V.toLowerCase())||e.email?.toLowerCase().includes(V.toLowerCase()),s="all"===$||e.role===$,o="all"===F||"active"===F&&e.isActive||"blocked"===F&&!e.isActive;return t&&s&&o}),q=e=>{D(t=>t.map(t=>{if(t.id===e){const s={...t,isActive:!t.isActive,updatedAt:(new Date).toISOString()},o={id:Date.now().toString(),userId:l.id,userName:l.fullName||l.login,action:s.isActive?"unblock_user":"block_user",resource:"user",resourceId:e,details:`${s.isActive?"Разблокирован":"Заблокирован"} пользователь "${s.login}"`,timestamp:(new Date).toISOString()};return O(e=>[o,...e]),s}return t}))},H=e=>{const t=A.find(t=>t.id===e);if(t){D(t=>t.filter(t=>t.id!==e));const s={id:Date.now().toString(),userId:l.id,userName:l.fullName||l.login,action:"delete_user",resource:"user",resourceId:e,details:`Удален пользователь "${t.login}"`,timestamp:(new Date).toISOString()};O(e=>[s,...e])}},Y={total:A.length,active:A.filter(e=>e.isActive).length,blocked:A.filter(e=>!e.isActive).length,online:A.filter(e=>e.lastLoginAt&&new Date(e.lastLoginAt)>new Date(Date.now()-36e5)).length};return o.jsx(n,{title:"Управление пользователями",subtitle:"Создание, редактирование и управление пользователями системы",children:o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[o.jsx("div",{className:"bg-white rounded-lg border border-mono-200 p-4",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-sm text-mono-600",children:"Всего пользователей"}),o.jsx("p",{className:"text-2xl font-bold text-mono-900",children:Y.total})]}),o.jsx(c,{className:"h-8 w-8 text-blue-500"})]})}),o.jsx("div",{className:"bg-white rounded-lg border border-mono-200 p-4",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-sm text-mono-600",children:"Активных"}),o.jsx("p",{className:"text-2xl font-bold text-mono-600",children:Y.active})]}),o.jsx(i,{className:"h-8 w-8 text-green-500"})]})}),o.jsx("div",{className:"bg-white rounded-lg border border-mono-200 p-4",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-sm text-mono-600",children:"Заблокированных"}),o.jsx("p",{className:"text-2xl font-bold text-mono-600",children:Y.blocked})]}),o.jsx(d,{className:"h-8 w-8 text-mono-500"})]})}),o.jsx("div",{className:"bg-white rounded-lg border border-mono-200 p-4",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-sm text-mono-600",children:"Онлайн"}),o.jsx("p",{className:"text-2xl font-bold text-black",children:Y.online})]}),o.jsx(m,{className:"h-8 w-8 text-blue-500"})]})})]}),o.jsx("div",{className:"bg-white rounded-lg border border-mono-200 p-4",children:o.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[o.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 flex-1",children:[o.jsxs("div",{className:"relative",children:[o.jsx(x,{className:"h-4 w-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-mono-400"}),o.jsx("input",{type:"text",placeholder:"Поиск пользователей...",value:V,onChange:e=>U(e.target.value),className:"pl-10 pr-4 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-transparent"})]}),o.jsxs("select",{value:$,onChange:e=>G(e.target.value),className:"px-3 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-transparent",children:[o.jsx("option",{value:"all",children:"Все роли"}),Object.entries(v).map(([e,t])=>o.jsx("option",{value:e,children:t},e))]}),o.jsxs("select",{value:F,onChange:e=>_(e.target.value),className:"px-3 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-transparent",children:[o.jsx("option",{value:"all",children:"Все статусы"}),o.jsx("option",{value:"active",children:"Активные"}),o.jsx("option",{value:"blocked",children:"Заблокированные"})]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(r,{viewMode:I,onViewModeChange:C}),o.jsxs("button",{onClick:()=>E(!0),className:"bg-black text-white px-4 py-2 rounded-lg hover:bg-black transition-colors duration-200 flex items-center gap-2",children:[o.jsx(u,{className:"h-4 w-4"}),"Добавить пользователя"]})]})]})}),"list"===I?o.jsx("div",{className:"bg-white rounded-lg border border-mono-200 overflow-hidden",children:o.jsx("div",{className:"overflow-x-auto",children:o.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[o.jsx("thead",{className:"bg-mono-50",children:o.jsxs("tr",{children:[o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Пользователь"}),o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Email"}),o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Роль"}),o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Статус"}),o.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Последний вход"}),o.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Действия"})]})}),o.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:K.map(e=>o.jsxs("tr",{className:"hover:bg-mono-50",children:[o.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:o.jsxs("div",{className:"flex items-center",children:[o.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:o.jsx("div",{className:"h-10 w-10 rounded-full bg-mono-200 flex items-center justify-center",children:o.jsx(h,{className:"h-5 w-5 text-mono-600"})})}),o.jsxs("div",{className:"ml-4",children:[o.jsx("div",{className:"text-sm font-medium text-mono-900",children:e.fullName||e.login}),o.jsx("div",{className:"text-sm text-mono-500",children:e.login})]})]})}),o.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:o.jsxs("div",{className:"flex items-center text-sm text-mono-900",children:[o.jsx(p,{className:"h-4 w-4 text-mono-400 mr-2"}),e.email||"—"]})}),o.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:o.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${w[e.role]}`,children:[o.jsx(g,{className:"h-3 w-3 mr-1"}),v[e.role]]})}),o.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:o.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(e.isActive?"text-green-800 bg-mono-100":"text-red-800 bg-red-100"),children:e.isActive?o.jsxs(o.Fragment,{children:[o.jsx(i,{className:"h-3 w-3 mr-1"}),"Активен"]}):o.jsxs(o.Fragment,{children:[o.jsx(d,{className:"h-3 w-3 mr-1"}),"Заблокирован"]})})}),o.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-mono-900",children:e.lastLoginAt?new Date(e.lastLoginAt).toLocaleString("ru-RU"):"Никогда"}),o.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:o.jsxs("div",{className:"flex items-center justify-end gap-2",children:[o.jsx("button",{onClick:()=>{T(e),M(!0)},className:"text-black hover:text-black p-1",title:"Редактировать",children:o.jsx(j,{className:"h-4 w-4"})}),o.jsx("button",{onClick:()=>q(e.id),className:"p-1 "+(e.isActive?"text-mono-600 hover:text-red-900":"text-mono-600 hover:text-green-900"),title:e.isActive?"Заблокировать":"Разблокировать",children:e.isActive?o.jsx(d,{className:"h-4 w-4"}):o.jsx(i,{className:"h-4 w-4"})}),o.jsx("button",{onClick:()=>H(e.id),className:"text-mono-600 hover:text-red-900 p-1",title:"Удалить",children:o.jsx(b,{className:"h-4 w-4"})})]})})]},e.id))})]})})}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:K.map(e=>o.jsxs("div",{className:"bg-white rounded-lg border border-mono-200 p-6 hover:shadow-lg transition-shadow duration-200 relative",children:[o.jsxs("div",{className:"absolute top-4 right-4 flex items-center gap-1",children:[o.jsx("button",{onClick:()=>{T(e),M(!0)},className:"text-black hover:text-black p-1 rounded hover:bg-mono-50 transition-colors duration-200",title:"Редактировать",children:o.jsx(j,{className:"h-4 w-4"})}),o.jsx("button",{onClick:()=>q(e.id),className:"p-1 rounded hover:bg-mono-50 transition-colors duration-200 "+(e.isActive?"text-mono-600 hover:text-red-900":"text-mono-600 hover:text-green-900"),title:e.isActive?"Заблокировать":"Разблокировать",children:e.isActive?o.jsx(d,{className:"h-4 w-4"}):o.jsx(i,{className:"h-4 w-4"})}),o.jsx("button",{onClick:()=>H(e.id),className:"text-mono-600 hover:text-red-900 p-1 rounded hover:bg-red-50 transition-colors duration-200",title:"Удалить",children:o.jsx(b,{className:"h-4 w-4"})})]}),o.jsxs("div",{className:"flex items-center mb-4 pr-20",children:[o.jsx("div",{className:"flex-shrink-0 h-12 w-12",children:o.jsx("div",{className:"h-12 w-12 rounded-full bg-mono-200 flex items-center justify-center",children:o.jsx(h,{className:"h-6 w-6 text-mono-600"})})}),o.jsxs("div",{className:"ml-4 flex-1 min-w-0",children:[o.jsx("div",{className:"text-lg font-semibold text-mono-900 truncate",children:e.fullName||e.login}),o.jsx("div",{className:"text-sm text-mono-500 truncate",children:e.login})]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex items-center text-sm text-mono-600",children:[o.jsx(p,{className:"h-4 w-4 text-mono-400 mr-2"}),e.email||"Email не указан"]}),o.jsx("div",{className:"flex items-center",children:o.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${w[e.role]} whitespace-nowrap`,children:[o.jsx(g,{className:"h-3 w-3 mr-1 flex-shrink-0"}),o.jsx("span",{className:"truncate",children:v[e.role]})]})}),o.jsx("div",{className:"flex items-center",children:o.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium whitespace-nowrap "+(e.isActive?"text-green-800 bg-mono-100":"text-red-800 bg-red-100"),children:e.isActive?o.jsxs(o.Fragment,{children:[o.jsx(i,{className:"h-3 w-3 mr-1 flex-shrink-0"}),o.jsx("span",{children:"Активен"})]}):o.jsxs(o.Fragment,{children:[o.jsx(d,{className:"h-3 w-3 mr-1 flex-shrink-0"}),o.jsx("span",{children:"Заблокирован"})]})})}),o.jsxs("div",{className:"text-sm text-mono-500",children:[o.jsx("div",{className:"font-medium text-mono-700",children:"Последний вход:"}),e.lastLoginAt?new Date(e.lastLoginAt).toLocaleString("ru-RU"):"Никогда"]})]})]},e.id))}),o.jsx(S,{isOpen:R,onClose:()=>E(!1),onSubmit:e=>{const t={id:Date.now().toString(),...e,isActive:!0,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};D(e=>[...e,t]);const s={id:Date.now().toString(),userId:l.id,userName:l.fullName||l.login,action:"create_user",resource:"user",resourceId:t.id,details:`Создан пользователь "${t.login}" с ролью "${v[t.role]}"`,timestamp:(new Date).toISOString()};O(e=>[s,...e]),E(!1)}}),o.jsx(y,{isOpen:L,onClose:()=>{M(!1),T(null)},user:P,onSubmit:e=>{P&&(D(t=>t.map(t=>t.id===P.id?{...t,...e,updatedAt:(new Date).toISOString()}:t)),M(!1),T(null))}})]})})}function S({isOpen:e,onClose:t,onSubmit:n}){const[r,i]=a.useState({login:"",password:"",role:s.MANAGER,fullName:"",email:""});return o.jsx(l,{isOpen:e,onClose:t,title:"Добавить пользователя",children:o.jsxs("form",{onSubmit:e=>{e.preventDefault(),r.login&&r.password&&(n(r),i({login:"",password:"",role:s.MANAGER,fullName:"",email:""}))},className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-mono-700 mb-1",children:"Логин *"}),o.jsx("input",{type:"text",value:r.login,onChange:e=>i(t=>({...t,login:e.target.value})),className:"w-full px-3 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-transparent",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-mono-700 mb-1",children:"Пароль *"}),o.jsx("input",{type:"password",value:r.password,onChange:e=>i(t=>({...t,password:e.target.value})),className:"w-full px-3 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-transparent",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-mono-700 mb-1",children:"Роль *"}),o.jsx("select",{value:r.role,onChange:e=>i(t=>({...t,role:e.target.value})),className:"w-full px-3 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-transparent",children:Object.entries(v).map(([e,t])=>o.jsx("option",{value:e,children:t},e))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-mono-700 mb-1",children:"ФИО"}),o.jsx("input",{type:"text",value:r.fullName,onChange:e=>i(t=>({...t,fullName:e.target.value})),className:"w-full px-3 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-transparent"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-mono-700 mb-1",children:"Email"}),o.jsx("input",{type:"email",value:r.email,onChange:e=>i(t=>({...t,email:e.target.value})),className:"w-full px-3 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-transparent"})]}),o.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[o.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-mono-600 border border-mono-300 rounded-lg hover:bg-mono-50 transition-colors duration-200",children:"Отмена"}),o.jsx("button",{type:"submit",className:"px-4 py-2 bg-black text-white rounded-lg hover:bg-black transition-colors duration-200",children:"Создать"})]})]})})}function y({isOpen:e,onClose:t,user:n,onSubmit:r}){const[i,c]=a.useState({fullName:"",email:"",role:s.MANAGER,isActive:!0});a.useEffect(()=>{n&&c({fullName:n.fullName||"",email:n.email||"",role:n.role,isActive:n.isActive})},[n]);return o.jsx(l,{isOpen:e,onClose:t,title:"Редактировать пользователя",children:o.jsxs("form",{onSubmit:e=>{e.preventDefault(),r(i)},className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-mono-700 mb-1",children:"ФИО"}),o.jsx("input",{type:"text",value:i.fullName,onChange:e=>c(t=>({...t,fullName:e.target.value})),className:"w-full px-3 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-transparent"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-mono-700 mb-1",children:"Email"}),o.jsx("input",{type:"email",value:i.email,onChange:e=>c(t=>({...t,email:e.target.value})),className:"w-full px-3 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-transparent"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-mono-700 mb-1",children:"Роль"}),o.jsx("select",{value:i.role,onChange:e=>c(t=>({...t,role:e.target.value})),className:"w-full px-3 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-transparent",children:Object.entries(v).map(([e,t])=>o.jsx("option",{value:e,children:t},e))})]}),o.jsxs("div",{className:"flex items-center",children:[o.jsx("input",{type:"checkbox",id:"isActive",checked:i.isActive,onChange:e=>c(t=>({...t,isActive:e.target.checked})),className:"h-4 w-4 text-black focus:ring-mono-500 border-mono-300 rounded"}),o.jsx("label",{htmlFor:"isActive",className:"ml-2 block text-sm text-mono-700",children:"Пользователь активен"})]}),o.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[o.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-mono-600 border border-mono-300 rounded-lg hover:bg-mono-50 transition-colors duration-200",children:"Отмена"}),o.jsx("button",{type:"submit",className:"px-4 py-2 bg-black text-white rounded-lg hover:bg-black transition-colors duration-200",children:"Сохранить"})]})]})})}export{A as default};
