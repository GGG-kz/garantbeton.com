import{j as e,u as s,a as t}from"./index-DssK2aQr.js";import{r,R as o}from"./vendor-CPG67Noa.js";import{M as i}from"./Modal-_SIwUgx5.js";import{aj as a,l as n,A as l,ak as d,al as c,Q as m,i as x}from"./ui-DT0cN5GG.js";const h=({onWeightChange:s,className:t="",warehouseId:o,warehouseName:i,comPort:m,showAdvanced:x=!1,autoConnect:h=!1})=>{const[b,u]=r.useState(!1),[p,j]=r.useState(null),[g,N]=r.useState(null),[v,f]=r.useState(!1),y={port:m||"COM3",baudRate:9600,dataBits:8,stopBits:1,parity:"none"},w=()=>"serial"in navigator,W=async e=>{const t=e.readable.getReader();try{for(;b;){const{value:e,done:r}=await t.read();if(r)break;const o=(new TextDecoder).decode(e).match(/(\d+\.?\d*)/);if(o){const e=parseFloat(o[1]);j(e),s?.(e)}}}catch(r){N("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –≤–µ—Å–æ–≤")}finally{t.releaseLock()}};return r.useEffect(()=>{},[]),e.jsxs("div",{className:`p-4 bg-white border border-mono-200 rounded-lg shadow-sm ${t}`,children:[e.jsx("div",{className:"mb-2 p-2 bg-mono-50 border border-mono-200 rounded text-xs text-mono-600",children:"üîß –û–¢–õ–ê–î–ö–ê: ScalesWidget –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ!"}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{className:"h-5 w-5 text-mono-600"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium text-black",children:["‚öñÔ∏è –í–µ—Å—ã ",i?`(${i})`:""]}),m&&e.jsxs("p",{className:"text-xs text-mono-500",children:["–ü–æ—Ä—Ç: ",m," ‚Ä¢ 9600 bps, 8N1"]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:b?e.jsxs("div",{className:"flex items-center space-x-1 text-mono-800",children:[e.jsx(n,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"–ü–æ–¥–∫–ª—é—á–µ–Ω–æ"})]}):e.jsxs("div",{className:"flex items-center space-x-1 text-mono-600",children:[e.jsx(l,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"–û—Ç–∫–ª—é—á–µ–Ω–æ"})]})})]}),e.jsxs("div",{className:"mb-4 p-3 bg-mono-50 rounded-lg",children:[e.jsx("div",{className:"text-sm text-mono-600 mb-2",children:"–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-mono-500",children:[e.jsxs("div",{children:["–ü–æ—Ä—Ç: ",y.port]}),e.jsxs("div",{children:["–°–∫–æ—Ä–æ—Å—Ç—å: ",y.baudRate," bps"]}),e.jsxs("div",{children:["–î–∞–Ω–Ω—ã–µ: ",y.dataBits,"N",y.stopBits]}),e.jsxs("div",{children:["–ß–µ—Ç–Ω–æ—Å—Ç—å: ",y.parity]})]})]}),e.jsxs("div",{className:"flex space-x-2 mb-4",children:[b?e.jsxs("button",{onClick:async()=>{try{u(!1),j(null),N(null)}catch(e){}},className:"flex items-center space-x-2 px-3 py-2 bg-mono-800 text-white rounded-lg hover:bg-black text-sm",children:[e.jsx(c,{className:"h-4 w-4"}),e.jsx("span",{children:"–û—Ç–∫–ª—é—á–∏—Ç—å"})]}):e.jsxs("button",{onClick:async()=>{if(w())try{f(!0),N(null);const e=await navigator.serial.requestPort({filters:[{usbVendorId:6790}]});await e.open({baudRate:y.baudRate,dataBits:y.dataBits,stopBits:y.stopBits,parity:y.parity}),u(!0),W(e)}catch(e){N(`–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${e instanceof Error?e.message:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"}`),u(!1)}finally{f(!1)}else N("Web Serial API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ")},disabled:v||!w(),className:"flex items-center space-x-2 px-3 py-2 bg-black text-white rounded-lg hover:bg-mono-800 disabled:bg-mono-400 disabled:cursor-not-allowed text-sm",children:[e.jsx(d,{className:"h-4 w-4"}),e.jsx("span",{children:v?"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...":"–ü–æ–¥–∫–ª—é—á–∏—Ç—å"})]}),b&&e.jsxs("button",{onClick:async()=>{if(b)try{f(!0),N(null)}catch(e){N("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≤–µ—Å–∞")}finally{f(!1)}else N("–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –≤–µ—Å–∞–º")},disabled:v,className:"flex items-center space-x-2 px-3 py-2 bg-mono-700 text-white rounded-lg hover:bg-mono-800 disabled:bg-mono-400 text-sm",children:[e.jsx(a,{className:"h-4 w-4"}),e.jsx("span",{children:v?"–í–∑–≤–µ—à–∏–≤–∞–Ω–∏–µ...":"–ü–æ–ª—É—á–∏—Ç—å –≤–µ—Å"})]})]}),null!==p&&e.jsxs("div",{className:"p-3 bg-mono-100 border border-mono-200 rounded-lg",children:[e.jsx("div",{className:"text-sm text-mono-600 mb-1",children:"–¢–µ–∫—É—â–∏–π –≤–µ—Å:"}),e.jsxs("div",{className:"text-2xl font-bold text-black",children:[p.toFixed(2)," –∫–≥"]})]}),g&&e.jsx("div",{className:"p-3 bg-mono-100 border border-mono-300 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2 text-mono-800",children:[e.jsx(l,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:g})]})}),!w()&&e.jsx("div",{className:"p-3 bg-mono-100 border border-mono-300 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2 text-mono-700",children:[e.jsx(l,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Web Serial API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Chrome/Edge –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å COM-–ø–æ—Ä—Ç–∞–º–∏."})]})})]})};function b({isOpen:n,onClose:l,onSave:d,invoice:c,title:b}){const{user:u}=s(),[p]=t("drivers",[]),[j]=t("vehicles",[]),g=[{id:"vehicle-1",type:"concrete_mixer",model:"–ö–∞–º–∞–∑-53215",licensePlate:"01ABC123",capacity:6,isHired:!1,status:"available",isActive:!0,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()},{id:"vehicle-2",type:"dump_truck",model:"–ú–ê–ó-6312",licensePlate:"02DEF456",capacity:8,isHired:!1,status:"available",isActive:!0,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()},{id:"vehicle-3",type:"concrete_mixer",model:"–ó–ò–õ-130",licensePlate:"03GHI789",capacity:5,isHired:!0,status:"available",isActive:!0,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}],[N]=t("vehicles",g),[v]=t("counterparties",[]),[f]=t("materials",[]);t("warehouses",[]);const[y]=t("warehouses",[]),[w,W]=r.useState({invoiceNumber:"",invoiceDate:(new Date).toISOString().split("T")[0],warehouse:"",seal:"",receivedBy:u?.login||u?.fullName||"",items:[]}),[S,k]=r.useState("warehouse-1"),[D,C]=r.useState(null),[B,I]=r.useState(null),O=y.find(e=>e.id===S);o.useEffect(()=>{if(n){if(c){const e=c.items.map(e=>{if(e.bruttoWeight&&e.taraWeight){const s=e.bruttoWeight-e.taraWeight;let t=s;return e.humidity&&e.humidity>0&&(t=s-s*e.humidity/100),{...e,netWeight:s,finalWeight:t,weighingStatus:"tara_done"}}return e});W({invoiceNumber:c.invoiceNumber,invoiceDate:c.invoiceDate,warehouse:c.warehouse,seal:c.seal||"",receivedBy:c.receivedBy,items:e}),k(c.warehouse)}else W({invoiceNumber:A(),invoiceDate:(new Date).toISOString().split("T")[0],warehouse:"",seal:"",receivedBy:u?.login||u?.fullName||"",items:[]}),k("warehouse-1");C(null),I(null)}},[n,c,u]);const A=()=>`–ü–ù-${(new Date).toISOString().slice(0,10).replace(/-/g,"")}-${Math.floor(1e3*Math.random()).toString().padStart(3,"0")}`,$=(e,s,t)=>{if("supplier"===s){v.find(e=>e.id===t)}if("material"===s){f.find(e=>e.id===t)}const r=[...w.items];if(r[e]={...r[e],[s]:t},"bruttoWeight"===s||"taraWeight"===s){const s=r[e];s.bruttoWeight&&s.taraWeight?(s.netWeight=s.bruttoWeight-s.taraWeight,s.weighingStatus="tara_done",s.humidity?s.finalWeight=s.netWeight-s.netWeight*s.humidity/100:s.finalWeight=s.netWeight):s.bruttoWeight&&(s.weighingStatus="brutto_done")}if("humidity"===s&&r[e].netWeight){const s=r[e];s.finalWeight=s.netWeight-s.netWeight*t/100}W(e=>({...e,items:r})),setTimeout(()=>{},100)},T=e=>e?`${e.toFixed(1)} –∫–≥`:"‚Äî",P=e=>e?new Date(e).toLocaleString("ru-RU"):"‚Äî",F=e=>{switch(e){case"pending":default:return"bg-mono-100 text-mono-800";case"brutto_done":case"tara_done":case"completed":return"bg-mono-100 text-black"}},R=e=>{switch(e){case"pending":return"–û–∂–∏–¥–∞–µ—Ç";case"brutto_done":return"–ë—Ä—É—Ç—Ç–æ –≥–æ—Ç–æ–≤–æ";case"tara_done":return"–ì–æ—Ç–æ–≤–æ";case"completed":return"–ó–∞–≤–µ—Ä—à–µ–Ω–æ";default:return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"}};return e.jsx(i,{isOpen:n,onClose:l,title:"üìã –ü—Ä–∏—Ö–æ–¥–Ω–∞—è –Ω–∞–∫–ª–∞–¥–Ω–∞—è",size:"xl",children:e.jsxs("div",{className:"space-y-6",children:[O&&O.scalesEnabled&&e.jsxs("div",{className:"bg-white border border-mono-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-mono-900",children:["‚öñÔ∏è –í–µ—Å—ã (",O.name,")"]}),e.jsxs("button",{type:"button",onClick:async()=>{O?.scalesEnabled||alert("–í–µ—Å—ã –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è —ç—Ç–æ–≥–æ —Å–∫–ª–∞–¥–∞")},className:"px-3 py-1 bg-mono-600 text-white text-sm rounded-lg hover:bg-mono-700 flex items-center space-x-1",title:"–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –≤–µ—Å–∞–º",children:[e.jsx(a,{className:"h-4 w-4"}),e.jsx("span",{children:"–ü–æ–ª—É—á–∏—Ç—å –≤–µ—Å"})]})]}),D&&e.jsxs("div",{className:"mb-4 p-3 bg-mono-50 border border-mono-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-black",children:"–¢–µ–∫—É—â–∏–π –≤–µ—Å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:"}),e.jsxs("p",{className:"text-xl font-bold text-black",children:[D.toFixed(1)," –∫–≥"]})]}),e.jsx(h,{onWeightChange:C,className:"border border-mono-200",warehouseId:O?.id,warehouseName:O?.name,comPort:O?.scalesComPort,showAdvanced:!1,autoConnect:!1})]}),e.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!w.invoiceNumber.trim())return void alert("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –Ω–∞–∫–ª–∞–¥–Ω–æ–π");if(0===w.items.length)return void alert("–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –ø–æ–∑–∏—Ü–∏—é");for(let t=0;t<w.items.length;t++){const e=w.items[t];if(!(e.vehicleNumber&&e.supplier&&e.buyer&&e.material))return void alert(`–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –≤ –ø–æ–∑–∏—Ü–∏–∏ ${t+1}`)}const s={invoiceNumber:w.invoiceNumber,invoiceDate:w.invoiceDate,warehouse:w.warehouse,seal:w.seal,items:w.items.map(e=>({vehicleNumber:e.vehicleNumber,supplier:e.supplier,buyer:e.buyer,material:e.material,bruttoWeight:e.bruttoWeight,bruttoDateTime:e.bruttoDateTime,taraWeight:e.taraWeight,taraDateTime:e.taraDateTime,netWeight:e.netWeight,humidity:e.humidity,finalWeight:e.finalWeight,weighingStatus:e.weighingStatus})),receivedBy:w.receivedBy,issuedBy:w.receivedBy};d(s),l()},className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"invoiceNumber",className:"block text-sm font-medium text-mono-700 mb-2",children:"–ù–æ–º–µ—Ä –Ω–∞–∫–ª–∞–¥–Ω–æ–π *"}),e.jsx("input",{type:"text",id:"invoiceNumber",value:w.invoiceNumber,onChange:e=>W(s=>({...s,invoiceNumber:e.target.value})),className:"w-full px-3 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-mono-500",placeholder:"–ü–ù-YYYYMMDD-XXX"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"invoiceDate",className:"block text-sm font-medium text-mono-700 mb-2",children:"–î–∞—Ç–∞ –Ω–∞–∫–ª–∞–¥–Ω–æ–π *"}),e.jsx("input",{type:"date",id:"invoiceDate",value:w.invoiceDate,onChange:e=>W(s=>({...s,invoiceDate:e.target.value})),className:"w-full px-3 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-mono-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"warehouse",className:"block text-sm font-medium text-mono-700 mb-2",children:"–°–∫–ª–∞–¥ *"}),e.jsxs("select",{id:"warehouse",value:w.warehouse,onChange:e=>{W(s=>({...s,warehouse:e.target.value})),k(e.target.value)},className:"w-full px-3 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-mono-500",children:[e.jsx("option",{value:"",children:"–í—ã–±–µ—Ä–∏—Ç–µ —Å–∫–ª–∞–¥"}),y.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-mono-900",children:"–ü–æ–∑–∏—Ü–∏–∏ –Ω–∞–∫–ª–∞–¥–Ω–æ–π"}),e.jsxs("button",{type:"button",onClick:()=>{const e=(()=>{if("driver"!==u?.role)return"";const e=p.find(e=>e.login===u.login);if(!e||!e.vehicleIds?.length)return"";const s=j.find(s=>e.vehicleIds.includes(s.id));return s?.licensePlate||""})(),s={id:Date.now().toString()+Math.random().toString(36).substr(2,9),vehicleNumber:e,supplier:"",buyer:"",material:"",weighingStatus:"pending"};W(e=>({...e,items:[...e.items,s]}))},className:"flex items-center space-x-2 px-4 py-2 bg-black text-white rounded-lg hover:bg-black",children:[e.jsx(m,{className:"h-4 w-4"}),e.jsx("span",{children:"–î–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é"})]})]}),e.jsx("div",{className:"space-y-4",children:w.items.map((s,t)=>e.jsxs("div",{className:"bg-mono-50 border border-mono-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-medium text-mono-900",children:["–ü–æ–∑–∏—Ü–∏—è ",t+1]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${F(s.weighingStatus)}`,children:R(s.weighingStatus)}),e.jsx("button",{type:"button",onClick:()=>(e=>{const s=w.items.filter((s,t)=>t!==e);W(e=>({...e,items:s}))})(t),className:"text-mono-600 hover:text-black",children:e.jsx(x,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-mono-700 mb-1",children:"–ù–æ–º–µ—Ä –º–∞—à–∏–Ω—ã *"}),e.jsx("input",{type:"text",value:s.vehicleNumber,onChange:e=>$(t,"vehicleNumber",e.target.value.toUpperCase()),className:"w-full px-3 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-mono-500 text-sm",placeholder:"–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä: 01ABC123)",list:`vehicle-list-${t}`}),e.jsx("datalist",{id:`vehicle-list-${t}`,children:N.map(s=>e.jsxs("option",{value:s.licensePlate,children:[s.licensePlate," (",s.model,")"]},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-mono-700 mb-1",children:"–ü–æ—Å—Ç–∞–≤—â–∏–∫ *"}),e.jsxs("select",{value:s.supplier,onChange:e=>$(t,"supplier",e.target.value),className:"w-full px-3 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-mono-500 text-sm",children:[e.jsx("option",{value:"",children:"–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞"}),v.filter(e=>"supplier"===e.type).map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-mono-700 mb-1",children:"–ü–æ–∫—É–ø–∞—Ç–µ–ª—å *"}),e.jsxs("select",{value:s.buyer,onChange:e=>$(t,"buyer",e.target.value),className:"w-full px-3 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-mono-500 text-sm",children:[e.jsx("option",{value:"",children:"–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è"}),v.filter(e=>"client"===e.type).map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-mono-700 mb-1",children:"–ú–∞—Ç–µ—Ä–∏–∞–ª *"}),e.jsxs("select",{value:s.material,onChange:e=>$(t,"material",e.target.value),className:"w-full px-3 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-mono-500 text-sm",children:[e.jsx("option",{value:"",children:"–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª"}),f.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.unit,")"]},s.id))]})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-mono-700 mb-1",children:"–ë–†–£–¢–¢–û"}),e.jsx("input",{type:"text",value:T(s.bruttoWeight),readOnly:!0,className:"w-full px-3 py-2 border border-mono-300 rounded-lg bg-mono-50 text-sm mb-2",title:`–û—Ç–ª–∞–¥–∫–∞: bruttoWeight = ${s.bruttoWeight}`}),e.jsxs("button",{type:"button",onClick:()=>(async()=>{if(O?.scalesEnabled)try{alert("–§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤–µ—Å–∞ –ë–†–£–¢–¢–û –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ —Ä–µ–∞–ª—å–Ω—ã–º –≤–µ—Å–∞–º")}catch(e){alert("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≤–µ—Å–∞ —Å –≤–µ—Å–æ–≤")}else alert("–í–µ—Å—ã –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è —ç—Ç–æ–≥–æ —Å–∫–ª–∞–¥–∞")})(),className:"w-full px-3 py-2 bg-black text-white rounded-lg hover:bg-black text-sm flex items-center justify-center space-x-1",title:"–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å –ë–†–£–¢–¢–û",children:[e.jsx(a,{className:"h-4 w-4"}),e.jsx("span",{children:"–ü–æ–ª—É—á–∏—Ç—å –≤–µ—Å"})]}),e.jsx("p",{className:"text-xs text-mono-500 mt-1",children:P(s.bruttoDateTime)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-mono-700 mb-1",children:"–¢–ê–†–ê"}),e.jsx("input",{type:"text",value:T(s.taraWeight),readOnly:!0,className:"w-full px-3 py-2 border border-mono-300 rounded-lg bg-mono-50 text-sm mb-2"}),e.jsxs("button",{type:"button",onClick:()=>(async()=>{if(O?.scalesEnabled)try{alert("–§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤–µ—Å–∞ –¢–ê–†–ê –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ —Ä–µ–∞–ª—å–Ω—ã–º –≤–µ—Å–∞–º")}catch(e){alert("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≤–µ—Å–∞ —Å –≤–µ—Å–æ–≤")}else alert("–í–µ—Å—ã –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è —ç—Ç–æ–≥–æ —Å–∫–ª–∞–¥–∞")})(),className:"w-full px-3 py-2 bg-black text-white rounded-lg hover:bg-mono-800 text-sm flex items-center justify-center space-x-1",title:"–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å –¢–ê–†–ê",children:[e.jsx(a,{className:"h-4 w-4"}),e.jsx("span",{children:"–ü–æ–ª—É—á–∏—Ç—å –≤–µ—Å"})]}),e.jsx("p",{className:"text-xs text-mono-500 mt-1",children:P(s.taraDateTime)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-mono-700 mb-1",children:"–ù–ï–¢–¢–û"}),e.jsx("input",{type:"text",value:T(s.netWeight),readOnly:!0,className:"w-full px-3 py-2 border border-mono-300 rounded-lg bg-mono-50 text-sm font-medium"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-mono-700 mb-1",children:"–í–ª–∞–∂–Ω–æ—Å—Ç—å (%)"}),e.jsx("input",{type:"number",min:"0",max:"100",step:"0.1",value:s.humidity||"",onChange:e=>$(t,"humidity",parseFloat(e.target.value)||0),className:"w-full px-3 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-mono-500 text-sm",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-mono-700 mb-1",children:"–ò—Ç–æ–≥–æ–≤—ã–π –≤–µ—Å"}),e.jsx("input",{type:"text",value:T(s.finalWeight),readOnly:!0,className:"w-full px-3 py-2 border border-mono-300 rounded-lg bg-mono-100 text-sm font-bold text-black"})]})]})]},s.id))}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"receivedBy",className:"block text-sm font-medium text-mono-700 mb-2",children:"–ü—Ä–∏–Ω—è–ª *"}),e.jsx("input",{type:"text",id:"receivedBy",value:w.receivedBy,onChange:e=>W(s=>({...s,receivedBy:e.target.value})),className:"w-full px-3 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-mono-500",placeholder:"–§–ò–û –∏ –¥–æ–ª–∂–Ω–æ—Å—Ç—å"})]}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-6 border-t border-mono-200",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 text-sm font-medium text-mono-700 bg-mono-100 hover:bg-mono-200 rounded-lg transition-colors duration-200",children:"–û—Ç–º–µ–Ω–∞"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-black hover:bg-black rounded-lg transition-colors duration-200",children:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"})]})]})]})})}function u({invoice:s}){const[r]=t("counterparties",[]),[o]=t("materials",[]),[i]=t("warehouses",[]),a=e=>new Date(e).toLocaleDateString("ru-RU"),n=e=>e?new Date(e).toLocaleString("ru-RU"):"‚Äî",l=e=>e?`${e.toFixed(1)} –∫–≥`:"‚Äî",d=e=>{const s=r.find(s=>s.id===e);return s?s.name:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç"},c=e=>{const s=o.find(s=>s.id===e);return s?`${s.name} (${s.unit})`:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª"},m=()=>s.items.reduce((e,s)=>e+(s.netWeight||0),0),x=()=>s.items.reduce((e,s)=>e+(s.finalWeight||0),0);return e.jsxs("div",{className:"bg-white p-8 max-w-4xl mx-auto print:p-4 print:max-w-none",children:[e.jsx("style",{children:"\n        @media print {\n          .no-print { display: none !important; }\n          body { margin: 0; }\n          .print-page { page-break-after: always; }\n          .print-page:last-child { page-break-after: avoid; }\n        }\n      "}),e.jsx("div",{className:"print-page mb-8",children:e.jsxs("div",{className:"border border-mono-800 p-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-xl font-bold uppercase",children:"–ü—Ä–∏—Ö–æ–¥–Ω–∞—è –Ω–∞–∫–ª–∞–¥–Ω–∞—è"}),e.jsxs("p",{className:"text-sm",children:["‚Ññ ",s.invoiceNumber," –æ—Ç ",a(s.invoiceDate)]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"–ü–æ—Å—Ç–∞–≤—â–∏–∫:"}),e.jsx("div",{className:"text-sm",children:s.items.length>0&&d(s.items[0].supplier)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"–ü–æ–∫—É–ø–∞—Ç–µ–ª—å:"}),e.jsx("div",{className:"text-sm",children:s.items.length>0&&d(s.items[0].buyer)})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"–ü–æ–∑–∏—Ü–∏–∏ –Ω–∞–∫–ª–∞–¥–Ω–æ–π:"}),e.jsxs("table",{className:"w-full border-collapse border border-mono-800 text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-mono-100",children:[e.jsx("th",{className:"border border-mono-800 p-2 text-left",children:"‚Ññ"}),e.jsx("th",{className:"border border-mono-800 p-2 text-left",children:"–ì–æ—Å. –Ω–æ–º–µ—Ä"}),e.jsx("th",{className:"border border-mono-800 p-2 text-left",children:"–ú–∞—Ç–µ—Ä–∏–∞–ª"}),e.jsx("th",{className:"border border-mono-800 p-2 text-left",children:"–ü–æ–∫—É–ø–∞—Ç–µ–ª—å"}),e.jsx("th",{className:"border border-mono-800 p-2 text-center",children:"–ë—Ä—É—Ç—Ç–æ"}),e.jsx("th",{className:"border border-mono-800 p-2 text-center",children:"–¢–∞—Ä–∞"}),e.jsx("th",{className:"border border-mono-800 p-2 text-center",children:"–ù–µ—Ç—Ç–æ"}),e.jsx("th",{className:"border border-mono-800 p-2 text-center",children:"–í–ª–∞–∂–Ω–æ—Å—Ç—å %"}),e.jsx("th",{className:"border border-mono-800 p-2 text-center",children:"–ò—Ç–æ–≥–æ–≤—ã–π –≤–µ—Å"})]})}),e.jsx("tbody",{children:s.items.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-mono-800 p-2",children:t+1}),e.jsx("td",{className:"border border-mono-800 p-2 font-medium",children:s.vehicleNumber}),e.jsx("td",{className:"border border-mono-800 p-2",children:c(s.material)}),e.jsx("td",{className:"border border-mono-800 p-2",children:d(s.buyer)}),e.jsx("td",{className:"border border-mono-800 p-2 text-center",children:l(s.bruttoWeight)}),e.jsx("td",{className:"border border-mono-800 p-2 text-center",children:l(s.taraWeight)}),e.jsx("td",{className:"border border-mono-800 p-2 text-center font-medium",children:l(s.netWeight)}),e.jsx("td",{className:"border border-mono-800 p-2 text-center",children:s.humidity?`${s.humidity}%`:"‚Äî"}),e.jsx("td",{className:"border border-mono-800 p-2 text-center font-bold text-mono-700",children:l(s.finalWeight)})]},s.id))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-mono-50 font-semibold",children:[e.jsx("td",{colSpan:4,className:"border border-mono-800 p-2 text-right",children:"–ò–¢–û–ì–û:"}),e.jsx("td",{className:"border border-mono-800 p-2 text-center",children:l(s.items.reduce((e,s)=>e+(s.bruttoWeight||0),0))}),e.jsx("td",{className:"border border-mono-800 p-2 text-center",children:l(s.items.reduce((e,s)=>e+(s.taraWeight||0),0))}),e.jsx("td",{className:"border border-mono-800 p-2 text-center",children:l(m())}),e.jsx("td",{className:"border border-mono-800 p-2 text-center",children:"‚Äî"}),e.jsx("td",{className:"border border-mono-800 p-2 text-center font-bold text-mono-700",children:l(x())})]})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"–í—Ä–µ–º—è –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏—è:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:s.items.map((s,t)=>e.jsxs("div",{className:"border border-mono-300 rounded p-3",children:[e.jsxs("div",{className:"font-medium",children:["–ú–∞—à–∏–Ω–∞ ",t+1,": ",s.vehicleNumber]}),e.jsxs("div",{children:["–ë—Ä—É—Ç—Ç–æ: ",n(s.bruttoDateTime)]}),e.jsxs("div",{children:["–¢–∞—Ä–∞: ",n(s.taraDateTime)]})]},s.id))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 mt-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm mb-2",children:"–ü—Ä–∏–Ω—è–ª:"}),e.jsx("div",{className:"border-b border-mono-800 mb-1"}),e.jsx("p",{className:"text-sm",children:s.receivedBy})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm mb-2",children:"–í—ã–ø–∏—Å–∞–ª:"}),e.jsx("div",{className:"border-b border-mono-800 mb-1"}),e.jsx("p",{className:"text-sm",children:s.issuedBy})]})]})]})}),e.jsx("div",{className:"print-page",children:e.jsxs("div",{className:"border border-mono-800 p-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-xl font-bold uppercase",children:"–ü—Ä–∏—Ö–æ–¥–Ω–∞—è –Ω–∞–∫–ª–∞–¥–Ω–∞—è"}),e.jsxs("p",{className:"text-sm",children:["‚Ññ ",s.invoiceNumber," –æ—Ç ",a(s.invoiceDate)]}),e.jsx("p",{className:"text-sm text-mono-600",children:"(–ö–æ–ø–∏—è)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"–ü–æ—Å—Ç–∞–≤—â–∏–∫:"}),e.jsx("div",{className:"text-sm",children:s.items.length>0&&d(s.items[0].supplier)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"–ü–æ–∫—É–ø–∞—Ç–µ–ª—å:"}),e.jsx("div",{className:"text-sm",children:s.items.length>0&&d(s.items[0].buyer)})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"–ü–æ–∑–∏—Ü–∏–∏ –Ω–∞–∫–ª–∞–¥–Ω–æ–π:"}),e.jsxs("table",{className:"w-full border-collapse border border-mono-800 text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-mono-100",children:[e.jsx("th",{className:"border border-mono-800 p-2 text-left",children:"‚Ññ"}),e.jsx("th",{className:"border border-mono-800 p-2 text-left",children:"–ì–æ—Å. –Ω–æ–º–µ—Ä"}),e.jsx("th",{className:"border border-mono-800 p-2 text-left",children:"–ú–∞—Ç–µ—Ä–∏–∞–ª"}),e.jsx("th",{className:"border border-mono-800 p-2 text-left",children:"–ü–æ–∫—É–ø–∞—Ç–µ–ª—å"}),e.jsx("th",{className:"border border-mono-800 p-2 text-center",children:"–ë—Ä—É—Ç—Ç–æ"}),e.jsx("th",{className:"border border-mono-800 p-2 text-center",children:"–¢–∞—Ä–∞"}),e.jsx("th",{className:"border border-mono-800 p-2 text-center",children:"–ù–µ—Ç—Ç–æ"}),e.jsx("th",{className:"border border-mono-800 p-2 text-center",children:"–í–ª–∞–∂–Ω–æ—Å—Ç—å %"}),e.jsx("th",{className:"border border-mono-800 p-2 text-center",children:"–ò—Ç–æ–≥–æ–≤—ã–π –≤–µ—Å"})]})}),e.jsx("tbody",{children:s.items.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-mono-800 p-2",children:t+1}),e.jsx("td",{className:"border border-mono-800 p-2 font-medium",children:s.vehicleNumber}),e.jsx("td",{className:"border border-mono-800 p-2",children:c(s.material)}),e.jsx("td",{className:"border border-mono-800 p-2",children:d(s.buyer)}),e.jsx("td",{className:"border border-mono-800 p-2 text-center",children:l(s.bruttoWeight)}),e.jsx("td",{className:"border border-mono-800 p-2 text-center",children:l(s.taraWeight)}),e.jsx("td",{className:"border border-mono-800 p-2 text-center font-medium",children:l(s.netWeight)}),e.jsx("td",{className:"border border-mono-800 p-2 text-center",children:s.humidity?`${s.humidity}%`:"‚Äî"}),e.jsx("td",{className:"border border-mono-800 p-2 text-center font-bold text-mono-700",children:l(s.finalWeight)})]},s.id))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-mono-50 font-semibold",children:[e.jsx("td",{colSpan:4,className:"border border-mono-800 p-2 text-right",children:"–ò–¢–û–ì–û:"}),e.jsx("td",{className:"border border-mono-800 p-2 text-center",children:l(s.items.reduce((e,s)=>e+(s.bruttoWeight||0),0))}),e.jsx("td",{className:"border border-mono-800 p-2 text-center",children:l(s.items.reduce((e,s)=>e+(s.taraWeight||0),0))}),e.jsx("td",{className:"border border-mono-800 p-2 text-center",children:l(m())}),e.jsx("td",{className:"border border-mono-800 p-2 text-center",children:"‚Äî"}),e.jsx("td",{className:"border border-mono-800 p-2 text-center font-bold text-mono-700",children:l(x())})]})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"–í—Ä–µ–º—è –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏—è:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:s.items.map((s,t)=>e.jsxs("div",{className:"border border-mono-300 rounded p-3",children:[e.jsxs("div",{className:"font-medium",children:["–ú–∞—à–∏–Ω–∞ ",t+1,": ",s.vehicleNumber]}),e.jsxs("div",{children:["–ë—Ä—É—Ç—Ç–æ: ",n(s.bruttoDateTime)]}),e.jsxs("div",{children:["–¢–∞—Ä–∞: ",n(s.taraDateTime)]})]},s.id))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 mt-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm mb-2",children:"–ü—Ä–∏–Ω—è–ª:"}),e.jsx("div",{className:"border-b border-mono-800 mb-1"}),e.jsx("p",{className:"text-sm",children:s.receivedBy})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm mb-2",children:"–í—ã–ø–∏—Å–∞–ª:"}),e.jsx("div",{className:"border-b border-mono-800 mb-1"}),e.jsx("p",{className:"text-sm",children:s.issuedBy})]})]})]})})]})}export{b as R,u as a};
