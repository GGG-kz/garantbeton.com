import{a as e,j as t,u as r,P as s}from"./index-DssK2aQr.js";import{r as a}from"./vendor-CPG67Noa.js";import{M as o}from"./Modal-_SIwUgx5.js";import{J as n,P as l,q as i,N as c,F as d,O as m,Q as x,a as p,V as u,i as h}from"./ui-DT0cN5GG.js";import"./utils-CHM7ATol.js";import"./forms-BH-hazHY.js";const j=[],v=[],N=[];function f({isOpen:r,onClose:s,onSave:o,price:m,title:x}){const[p]=e("counterparties",j),[u]=e("concreteGrades",v),[h]=e("materials",N),[f,b]=a.useState({counterpartyId:"",concreteGradeId:"",materialId:"",price:0,currency:"KZT",validFrom:(new Date).toISOString().split("T")[0],validTo:"",notes:"",priceType:"concrete"}),[y,g]=a.useState({});a.useEffect(()=>{b(m?{counterpartyId:m.counterpartyId,concreteGradeId:m.concreteGradeId||"",materialId:m.materialId||"",price:m.price,currency:m.currency,validFrom:m.validFrom.split("T")[0],validTo:m.validTo?m.validTo.split("T")[0]:"",notes:m.notes||"",priceType:m.concreteGradeId?"concrete":"material"}:{counterpartyId:"",concreteGradeId:"",materialId:"",price:0,currency:"KZT",validFrom:(new Date).toISOString().split("T")[0],validTo:"",notes:"",priceType:"concrete"}),g({})},[m,r]);const w=(e,t)=>{b(r=>({...r,[e]:t})),y[e]&&g(t=>({...t,[e]:""}))};return t.jsx("div",{className:"space-y-6",children:t.jsxs("form",{onSubmit:e=>{e.preventDefault();const t={};if(f.counterpartyId||(t.counterpartyId="Контрагент обязателен"),"concrete"!==f.priceType||f.concreteGradeId||(t.concreteGradeId="Марка бетона обязательна"),"material"!==f.priceType||f.materialId||(t.materialId="Материал обязателен"),f.price<=0&&(t.price="Цена должна быть больше 0"),f.validFrom||(t.validFrom="Дата начала обязательна"),Object.keys(t).length>0)return void g(t);const r=p.find(e=>e.id===f.counterpartyId),a=u.find(e=>e.id===f.concreteGradeId),n=h.find(e=>e.id===f.materialId),l={name:"concrete"===f.priceType?`${r?.name} - ${a?.name}`:`${r?.name} - ${n?.name}`,counterpartyId:f.counterpartyId,concreteGradeId:"concrete"===f.priceType?f.concreteGradeId:void 0,materialId:"material"===f.priceType?f.materialId:void 0,price:f.price,currency:f.currency,validFrom:f.validFrom+"T00:00:00Z",validTo:f.validTo?f.validTo+"T23:59:59Z":void 0,notes:f.notes};o(l),s()},className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-mono-700 mb-2",children:"Тип цены *"}),t.jsxs("div",{className:"flex space-x-4",children:[t.jsxs("label",{className:"flex items-center",children:[t.jsx("input",{type:"radio",name:"priceType",value:"concrete",checked:"concrete"===f.priceType,onChange:e=>w("priceType",e.target.value),className:"mr-2"}),t.jsx("span",{className:"text-sm text-mono-700",children:"Марка бетона"})]}),t.jsxs("label",{className:"flex items-center",children:[t.jsx("input",{type:"radio",name:"priceType",value:"material",checked:"material"===f.priceType,onChange:e=>w("priceType",e.target.value),className:"mr-2"}),t.jsx("span",{className:"text-sm text-mono-700",children:"Материал"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"counterpartyId",className:"block text-sm font-medium text-mono-700 mb-2",children:"Контрагент *"}),t.jsxs("div",{className:"relative",children:[t.jsx(n,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-mono-400"}),t.jsxs("select",{id:"counterpartyId",value:f.counterpartyId,onChange:e=>w("counterpartyId",e.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 "+(y.counterpartyId?"border-red-300":"border-mono-300"),children:[t.jsx("option",{value:"",children:"Выберите контрагента"}),p.filter(e=>e.isActive).map(e=>t.jsxs("option",{value:e.id,children:[e.name," (","client"===e.type?"Клиент":"Поставщик",")"]},e.id))]})]}),y.counterpartyId&&t.jsx("p",{className:"mt-1 text-sm text-mono-600",children:y.counterpartyId})]}),"concrete"===f.priceType?t.jsxs("div",{children:[t.jsx("label",{htmlFor:"concreteGradeId",className:"block text-sm font-medium text-mono-700 mb-2",children:"Марка бетона *"}),t.jsxs("div",{className:"relative",children:[t.jsx(l,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-mono-400"}),t.jsxs("select",{id:"concreteGradeId",value:f.concreteGradeId,onChange:e=>w("concreteGradeId",e.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 "+(y.concreteGradeId?"border-red-300":"border-mono-300"),children:[t.jsx("option",{value:"",children:"Выберите марку бетона"}),u.filter(e=>e.isActive).map(e=>t.jsxs("option",{value:e.id,children:[e.grade," - ",e.name]},e.id))]})]}),y.concreteGradeId&&t.jsx("p",{className:"mt-1 text-sm text-mono-600",children:y.concreteGradeId})]}):t.jsxs("div",{children:[t.jsx("label",{htmlFor:"materialId",className:"block text-sm font-medium text-mono-700 mb-2",children:"Материал *"}),t.jsxs("div",{className:"relative",children:[t.jsx(l,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-mono-400"}),t.jsxs("select",{id:"materialId",value:f.materialId,onChange:e=>w("materialId",e.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 "+(y.materialId?"border-red-300":"border-mono-300"),children:[t.jsx("option",{value:"",children:"Выберите материал"}),h.filter(e=>e.isActive).map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",e.type,", ",e.unit,")"]},e.id))]})]}),y.materialId&&t.jsx("p",{className:"mt-1 text-sm text-mono-600",children:y.materialId})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"price",className:"block text-sm font-medium text-mono-700 mb-2",children:"Цена (₸) *"}),t.jsxs("div",{className:"relative",children:[t.jsx(i,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-mono-400"}),t.jsx("input",{type:"number",id:"price",value:f.price,onChange:e=>w("price",parseFloat(e.target.value)||0),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 "+(y.price?"border-red-300":"border-mono-300"),placeholder:"0",min:"0",step:"0.01"})]}),y.price&&t.jsx("p",{className:"mt-1 text-sm text-mono-600",children:y.price})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"currency",className:"block text-sm font-medium text-mono-700 mb-2",children:"Валюта"}),t.jsx("select",{id:"currency",value:f.currency,onChange:e=>w("currency",e.target.value),className:"w-full px-4 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:t.jsx("option",{value:"KZT",children:"₸ Тенге"})})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"validFrom",className:"block text-sm font-medium text-mono-700 mb-2",children:"Дата начала действия *"}),t.jsxs("div",{className:"relative",children:[t.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-mono-400"}),t.jsx("input",{type:"date",id:"validFrom",value:f.validFrom,onChange:e=>w("validFrom",e.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 "+(y.validFrom?"border-red-300":"border-mono-300")})]}),y.validFrom&&t.jsx("p",{className:"mt-1 text-sm text-mono-600",children:y.validFrom})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"validTo",className:"block text-sm font-medium text-mono-700 mb-2",children:"Дата окончания действия"}),t.jsxs("div",{className:"relative",children:[t.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-mono-400"}),t.jsx("input",{type:"date",id:"validTo",value:f.validTo,onChange:e=>w("validTo",e.target.value),className:"w-full pl-10 pr-4 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]}),t.jsx("p",{className:"mt-1 text-xs text-mono-500",children:"Оставьте пустым для бессрочного действия"})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-mono-700 mb-2",children:"Примечания"}),t.jsxs("div",{className:"relative",children:[t.jsx(d,{className:"absolute left-3 top-3 h-4 w-4 text-mono-400"}),t.jsx("textarea",{id:"notes",value:f.notes,onChange:e=>w("notes",e.target.value),className:"w-full pl-10 pr-4 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",rows:3,placeholder:"Дополнительная информация о цене..."})]})]}),t.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t border-mono-200",children:[t.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 text-sm font-medium text-mono-700 bg-mono-100 hover:bg-mono-200 rounded-lg transition-colors duration-200",children:"Отмена"}),t.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors duration-200",children:"Сохранить"})]})]})})}const b=[];function y(){const{user:d}=r(),[j,v]=e("prices",b),[N,y]=a.useState(""),[g,w]=a.useState("all"),[I,T]=a.useState(!1),[k,G]=a.useState(null),[C,F]=a.useState(null);if(!d||!["accountant","director","supply"].includes(d.role))return t.jsx("div",{className:"flex items-center justify-center min-h-screen",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h1",{className:"text-2xl font-bold text-mono-900 mb-4",children:"Доступ запрещен"}),t.jsx("p",{className:"text-mono-600",children:"Эта страница доступна только бухгалтерам, директорам и снабженцам"})]})});const S=j.filter(e=>{const t=e.counterpartyName.toLowerCase().includes(N.toLowerCase())||e.concreteGradeName&&e.concreteGradeName.toLowerCase().includes(N.toLowerCase())||e.materialName&&e.materialName.toLowerCase().includes(N.toLowerCase()),r="all"===g||"concrete"===g&&e.concreteGradeId||"material"===g&&e.materialId;return t&&r&&e.isActive}),D=()=>{G(null),T(!0)},O=()=>{T(!1),G(null)},[$]=e("counterparties",[]),[A]=e("concreteGrades",[]),[Z]=e("materials",[]),L=e=>{const t=$.find(t=>t.id===e);return t?t.name:"Неизвестный контрагент"},K=e=>{const t=A.find(t=>t.id===e);return t?`${t.grade} - ${t.name}`:"Неизвестная марка"},z=e=>{const t=Z.find(t=>t.id===e);return t?`${t.name} (${t.type}, ${t.unit})`:"Неизвестный материал"},M=e=>new Intl.NumberFormat("kk-KZ",{style:"currency",currency:"KZT",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),P=e=>new Date(e).toLocaleDateString("kk-KZ"),q=e=>{const t=new Date,r=new Date(e.validFrom),s=e.validTo?new Date(e.validTo):null;return r<=t&&(!s||s>=t)};return t.jsxs(s,{title:"Управление ценами",subtitle:"Установка и редактирование цен для контрагентов",children:[t.jsx("div",{className:"mb-6 space-y-4",children:t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(m,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-mono-400"}),t.jsx("input",{type:"text",placeholder:"Поиск по контрагенту, марке бетона или материалу...",value:N,onChange:e=>y(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("button",{onClick:()=>w("all"),className:"px-4 py-2 text-sm font-medium rounded-lg transition-colors duration-200 "+("all"===g?"bg-primary-500 text-white":"bg-mono-100 text-mono-700 hover:bg-mono-200"),children:"Все"}),t.jsx("button",{onClick:()=>w("concrete"),className:"px-4 py-2 text-sm font-medium rounded-lg transition-colors duration-200 "+("concrete"===g?"bg-primary-500 text-white":"bg-mono-100 text-mono-700 hover:bg-mono-200"),children:"Бетон"}),t.jsx("button",{onClick:()=>w("material"),className:"px-4 py-2 text-sm font-medium rounded-lg transition-colors duration-200 "+("material"===g?"bg-primary-500 text-white":"bg-mono-100 text-mono-700 hover:bg-mono-200"),children:"Материалы"})]})]})}),t.jsx("div",{className:"mb-6",children:t.jsxs("button",{onClick:D,className:"inline-flex items-center space-x-2 px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors duration-200",children:[t.jsx(x,{className:"h-4 w-4"}),t.jsx("span",{children:"Добавить цену"})]})}),t.jsxs("div",{className:"bg-white rounded-lg border border-mono-200 overflow-hidden",children:[t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-mono-50 border-b border-mono-200",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Контрагент"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Продукт"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Цена"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Период действия"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Статус"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Действия"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:S.map(e=>t.jsxs("tr",{className:"hover:bg-mono-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(n,{className:"h-4 w-4 text-mono-400 mr-2"}),t.jsx("div",{children:t.jsx("div",{className:"text-sm font-medium text-mono-900",children:e.counterpartyName})})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(l,{className:"h-4 w-4 text-mono-400 mr-2"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-mono-900",children:e.concreteGradeName||e.materialName}),t.jsx("div",{className:"text-xs text-mono-500",children:e.concreteGradeName?"Марка бетона":"Материал"})]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(i,{className:"h-4 w-4 text-mono-400 mr-2"}),t.jsx("span",{className:"text-sm font-medium text-mono-900",children:M(e.price)})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(c,{className:"h-4 w-4 text-mono-400 mr-2"}),t.jsxs("div",{children:[t.jsxs("div",{className:"text-sm text-mono-900",children:["с ",P(e.validFrom)]}),e.validTo&&t.jsxs("div",{className:"text-xs text-mono-500",children:["по ",P(e.validTo)]})]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full "+(q(e)?"bg-mono-100 text-green-800":"bg-red-100 text-red-800"),children:q(e)?"Действует":"Истекла"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.jsx("button",{onClick:()=>(e=>{F(e)})(e),className:"text-black hover:text-black p-1 rounded transition-colors duration-200",title:"Просмотр",children:t.jsx(p,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>(e=>{G(e),T(!0)})(e),className:"text-indigo-600 hover:text-indigo-900 p-1 rounded transition-colors duration-200",title:"Редактировать",children:t.jsx(u,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>{return t=e.id,void(window.confirm("Вы уверены, что хотите удалить эту цену?")&&v(e=>e.filter(e=>e.id!==t)));var t},className:"text-mono-600 hover:text-red-900 p-1 rounded transition-colors duration-200",title:"Удалить",children:t.jsx(h,{className:"h-4 w-4"})})]})})]},e.id))})]})}),0===S.length&&t.jsxs("div",{className:"text-center py-12",children:[t.jsx(i,{className:"mx-auto h-12 w-12 text-mono-400"}),t.jsx("h3",{className:"mt-2 text-sm font-medium text-mono-900",children:"Цены не найдены"}),t.jsx("p",{className:"mt-1 text-sm text-mono-500",children:N?"Попробуйте изменить параметры поиска":"Начните с добавления первой цены"}),!N&&t.jsx("div",{className:"mt-6",children:t.jsxs("button",{onClick:D,className:"inline-flex items-center space-x-2 px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors duration-200",children:[t.jsx(x,{className:"h-4 w-4"}),t.jsx("span",{children:"Добавить цену"})]})})]})]}),t.jsx(o,{isOpen:I,onClose:O,title:k?"Редактировать цену":"Добавить цену",size:"lg",children:t.jsx(f,{isOpen:I,onClose:O,onSave:e=>{if(k)v(t=>t.map(t=>t.id===k.id?{...t,...e,counterpartyName:L(e.counterpartyId),concreteGradeName:e.concreteGradeId?K(e.concreteGradeId):void 0,materialName:e.materialId?z(e.materialId):void 0,updatedAt:(new Date).toISOString()}:t));else{const t={id:Date.now().toString(),...e,counterpartyName:L(e.counterpartyId),concreteGradeName:e.concreteGradeId?K(e.concreteGradeId):void 0,materialName:e.materialId?z(e.materialId):void 0,isActive:!0,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};v(e=>[...e,t])}},price:k,title:k?"Редактировать цену":"Добавить цену"})}),t.jsx(o,{isOpen:!!C,onClose:()=>F(null),title:"Информация о цене",size:"md",children:C&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-mono-700",children:"Контрагент"}),t.jsx("p",{className:"mt-1 text-sm text-mono-900",children:C.counterpartyName})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-mono-700",children:"Тип продукта"}),t.jsx("p",{className:"mt-1 text-sm text-mono-900",children:C.concreteGradeName?"Марка бетона":"Материал"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-mono-700",children:"Продукт"}),t.jsx("p",{className:"mt-1 text-sm text-mono-900",children:C.concreteGradeName||C.materialName})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-mono-700",children:"Цена"}),t.jsx("p",{className:"mt-1 text-sm text-mono-900",children:M(C.price)})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-mono-700",children:"Начало действия"}),t.jsx("p",{className:"mt-1 text-sm text-mono-900",children:P(C.validFrom)})]}),C.validTo&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-mono-700",children:"Окончание действия"}),t.jsx("p",{className:"mt-1 text-sm text-mono-900",children:P(C.validTo)})]})]}),C.notes&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-mono-700",children:"Примечания"}),t.jsx("p",{className:"mt-1 text-sm text-mono-900",children:C.notes})]}),t.jsx("div",{className:"flex justify-end pt-4 border-t border-mono-200",children:t.jsx("button",{onClick:()=>F(null),className:"px-4 py-2 text-sm font-medium text-mono-700 bg-mono-100 hover:bg-mono-200 rounded-lg transition-colors duration-200",children:"Закрыть"})})]})})]})}export{y as default};
