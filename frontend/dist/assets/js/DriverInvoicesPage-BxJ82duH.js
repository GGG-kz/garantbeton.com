import{j as e,a as s,f as t,P as r}from"./index-DssK2aQr.js";import{r as i}from"./vendor-CPG67Noa.js";import{V as a}from"./ViewToggle-BZCXPk9z.js";import{E as d}from"./ExpenseInvoicePrint-CKFMj2Ic.js";import{X as l,G as n,F as o,l as c,j as m,k as x,g as h,b as u,O as v,Y as p,N as j,T as N,S as b,a as g,ae as f,_ as y}from"./ui-DT0cN5GG.js";import"./utils-CHM7ATol.js";import"./forms-BH-hazHY.js";const w=[{value:"delivered",label:"Подписали накладную",icon:c,color:"text-mono-600"},{value:"rejected",label:"Не подписали накладную",icon:m,color:"text-mono-600"}],I=({invoice:s,isOpen:t,onClose:r,onSave:a})=>{const[d,c]=i.useState(s.driverActions||{departureConfirmed:!1,arrivalConfirmed:!1,departureFromObjectConfirmed:!1,arrivalAtPlantConfirmed:!1,invoiceStatus:"pending"}),[m,h]=i.useState(!1),[u,v]=i.useState(!1),p=e=>{const s=(new Date).toTimeString().slice(0,5);c(t=>({...t,["departure"===e?"departureFromPlantDriver":"arrival"===e?"arrivalAtObject":"departureFromObject"===e?"departureFromObject":"arrivalAtPlant"]:s,["departure"===e?"departureConfirmed":"arrival"===e?"arrivalConfirmed":"departureFromObject"===e?"departureFromObjectConfirmed":"arrivalAtPlantConfirmed"]:!0}))};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-mono-900",children:"Действия водителя"}),e.jsx("button",{onClick:r,className:"text-mono-400 hover:text-mono-600",children:e.jsx(l,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"bg-mono-50 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-mono-700",children:"Номер накладной:"}),e.jsx("p",{className:"text-mono-900",children:s.invoiceNumber})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-mono-700",children:"Клиент:"}),e.jsx("p",{className:"text-mono-900",children:s.customerName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-mono-700",children:"Объект:"}),e.jsx("p",{className:"text-mono-900",children:s.delivery.deliveryObject})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-mono-700",children:"Адрес:"}),e.jsx("p",{className:"text-mono-900",children:s.delivery.deliveryAddress||"Не указан"})]})]}),s.orderId&&e.jsxs("div",{className:"mt-4 p-3 bg-mono-50 border border-mono-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-mono-500 rounded-full mr-2"}),e.jsxs("span",{className:"text-sm font-medium text-black",children:["Связан с заказом #",s.orderId]})]}),e.jsx("p",{className:"text-xs text-black mt-1",children:"Статус заказа будет автоматически обновлен при сохранении действий"})]})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("h3",{className:"text-lg font-medium text-mono-900 flex items-center",children:[e.jsx(n,{className:"w-5 h-5 mr-2"}),"Фиксация времени"]}),e.jsx("div",{className:"border border-mono-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-mono-900",children:"Убытие с завода"}),e.jsxs("p",{className:"text-sm text-mono-500",children:["Диспетчер: ",s.timing.departureFromPlant,d.departureFromPlantDriver&&e.jsxs("span",{className:"ml-2 text-black",children:["→ Водитель: ",d.departureFromPlantDriver]})]})]}),e.jsx("button",{onClick:()=>p("departure"),disabled:d.departureConfirmed,className:"px-4 py-2 rounded-lg text-sm font-medium "+(d.departureConfirmed?"bg-mono-100 text-green-800":"bg-black text-white hover:bg-black"),children:d.departureConfirmed?"Подтверждено":"Подтвердить"})]})}),e.jsx("div",{className:"border border-mono-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-mono-900",children:"Прибытие на объект"}),d.arrivalAtObject&&e.jsxs("p",{className:"text-sm text-black",children:["Время: ",d.arrivalAtObject]})]}),e.jsx("button",{onClick:()=>p("arrival"),disabled:d.arrivalConfirmed,className:"px-4 py-2 rounded-lg text-sm font-medium "+(d.arrivalConfirmed?"bg-mono-100 text-green-800":"bg-black text-white hover:bg-black"),children:d.arrivalConfirmed?"Подтверждено":"Отметить прибытие"})]})}),e.jsx("div",{className:"border border-mono-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-mono-900",children:"Убытие с объекта"}),d.departureFromObject&&e.jsxs("p",{className:"text-sm text-black",children:["Время: ",d.departureFromObject]})]}),e.jsx("button",{onClick:()=>p("departureFromObject"),disabled:d.departureFromObjectConfirmed,className:"px-4 py-2 rounded-lg text-sm font-medium "+(d.departureFromObjectConfirmed?"bg-mono-100 text-green-800":"bg-black text-white hover:bg-black"),children:d.departureFromObjectConfirmed?"Подтверждено":"Отметить убытие"})]})}),e.jsx("div",{className:"border border-mono-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-mono-900",children:"Прибытие на завод"}),d.arrivalAtPlant&&e.jsxs("p",{className:"text-sm text-black",children:["Время: ",d.arrivalAtPlant]})]}),e.jsx("button",{onClick:()=>p("arrivalAtPlant"),disabled:d.arrivalAtPlantConfirmed,className:"px-4 py-2 rounded-lg text-sm font-medium "+(d.arrivalAtPlantConfirmed?"bg-mono-100 text-green-800":"bg-black text-white hover:bg-black"),children:d.arrivalAtPlantConfirmed?"Подтверждено":"Отметить прибытие"})]})})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("h3",{className:"text-lg font-medium text-mono-900 flex items-center",children:[e.jsx(o,{className:"w-5 h-5 mr-2"}),"Статус накладной"]}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:w.map(t=>{const r=t.icon;return e.jsxs("label",{className:"flex items-center p-4 border-2 rounded-lg cursor-pointer transition-colors "+(d.invoiceStatus===t.value?"border-mono-500 bg-mono-50":"border-mono-200 hover:border-mono-300"),children:[e.jsx("input",{type:"radio",name:"invoiceStatus",value:t.value,checked:d.invoiceStatus===t.value,onChange:()=>{return e=t.value,c(s=>({...s,invoiceStatus:e})),void h("rejected"===e);var e},className:"sr-only"}),e.jsx(r,{className:`w-5 h-5 mr-3 ${t.color}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium text-mono-900",children:t.label}),s.orderId&&e.jsx("p",{className:"text-xs text-mono-500 mt-1",children:"delivered"===t.value?'Заказ будет отмечен как "Выполнен"':"rejected"===t.value?'Заказ будет отмечен как "Отменен"':""})]})]},t.value)})}),m&&e.jsxs("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-red-800 mb-2",children:"Причина отказа"}),e.jsx("textarea",{value:d.rejectionReason||"",onChange:e=>c(s=>({...s,rejectionReason:e.target.value})),placeholder:"Укажите причину, по которой накладная не была подписана...",className:"w-full px-3 py-2 border border-red-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",rows:3})]})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-medium text-mono-900 flex items-center",children:[e.jsx(x,{className:"w-5 h-5 mr-2"}),"Заметки водителя"]}),e.jsx("button",{onClick:()=>v(!u),className:"text-black hover:text-black text-sm",children:u?"Скрыть":"Добавить"})]}),u&&e.jsx("textarea",{value:d.driverNotes||"",onChange:e=>c(s=>({...s,driverNotes:e.target.value})),placeholder:"Дополнительная информация о доставке...",className:"w-full px-3 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-transparent",rows:3})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t border-mono-200",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 text-mono-700 border border-mono-300 rounded-lg hover:bg-mono-50",children:"Отмена"}),e.jsx("button",{onClick:()=>{const e={...d,completedAt:"delivered"===d.invoiceStatus||"rejected"===d.invoiceStatus?(new Date).toISOString():void 0};a(e),r()},className:"px-6 py-2 bg-black text-white rounded-lg hover:bg-black",children:"Сохранить"})]})]})})}):null},k=()=>{const[l,x]=s("expenseInvoices",[]),[w,k]=s("orders",[]),[C]=s("drivers",[]),{addNotification:$}=t(),[D,O]=i.useState(""),[S,A]=i.useState(null),[F,P]=i.useState(!1),[T,V]=i.useState(!1),[L,R]=i.useState("list"),[M,_]=i.useState(""),[E,U]=i.useState(""),[z,G]=i.useState(!1),Y=C[0],q=i.useMemo(()=>Y?l.filter(e=>e.delivery.driverId===Y.id):[],[l,Y]),B=i.useMemo(()=>{let e=q;if(D){const s=D.toLowerCase();e=e.filter(e=>e.invoiceNumber.toLowerCase().includes(s)||e.delivery.deliveryObject.toLowerCase().includes(s)||e.customerName.toLowerCase().includes(s))}return M&&(e=e.filter(e=>new Date(e.invoiceDate)>=new Date(M))),E&&(e=e.filter(e=>new Date(e.invoiceDate)<=new Date(E))),e.sort((e,s)=>new Date(s.invoiceDate).getTime()-new Date(e.invoiceDate).getTime())},[q,D,M,E]),H=e=>{A(e),P(!0)},J=e=>{A(e),V(!0)},K=(e,s)=>{if(!e.orderId)return;const t=w.find(s=>s.id===e.orderId);if(!t)return;let r=t.status,i={...t};"delivered"===s.invoiceStatus?(r="completed",i={...t,status:"completed",completionTime:(new Date).toISOString(),assignedDriverId:e.delivery.driverId,assignedDriverName:e.delivery.driverName,assignedVehicleId:e.delivery.vehicleId,assignedVehicleNumber:e.delivery.vehicleNumber,departureTime:s.departureFromPlantDriver||e.timing.departureFromPlant,arrivalTime:s.arrivalAtObject,expenseInvoiceId:e.id}):"rejected"===s.invoiceStatus?(r="cancelled",i={...t,status:"cancelled",completionTime:(new Date).toISOString(),assignedDriverId:e.delivery.driverId,assignedDriverName:e.delivery.driverName,assignedVehicleId:e.delivery.vehicleId,assignedVehicleNumber:e.delivery.vehicleNumber,departureTime:s.departureFromPlantDriver||e.timing.departureFromPlant,arrivalTime:s.arrivalAtObject,expenseInvoiceId:e.id}):s.arrivalConfirmed?(r="in_production",i={...t,status:"in_production",assignedDriverId:e.delivery.driverId,assignedDriverName:e.delivery.driverName,assignedVehicleId:e.delivery.vehicleId,assignedVehicleNumber:e.delivery.vehicleNumber,departureTime:s.departureFromPlantDriver||e.timing.departureFromPlant,arrivalTime:s.arrivalAtObject,expenseInvoiceId:e.id}):s.departureConfirmed&&(r="ready",i={...t,status:"ready",assignedDriverId:e.delivery.driverId,assignedDriverName:e.delivery.driverName,assignedVehicleId:e.delivery.vehicleId,assignedVehicleNumber:e.delivery.vehicleNumber,departureTime:s.departureFromPlantDriver||e.timing.departureFromPlant,expenseInvoiceId:e.id}),k(s=>s.map(s=>s.id===e.orderId?i:s)),Q(t,i,e,s)},Q=(e,s,t,r)=>{const i=t.delivery.driverName||"Водитель",a=t.delivery.vehicleNumber||"";if($({title:"Статус заказа изменен",message:`Заказ #${s.id} изменен с "${Z(e.status)}" на "${Z(s.status)}" водителем ${i}`,type:"info",userId:"",role:"dispatcher",relatedOrderId:s.id,relatedInvoiceId:t.id,priority:"medium"}),$({title:"Статус заказа изменен",message:`Заказ #${s.id} изменен с "${Z(e.status)}" на "${Z(s.status)}" водителем ${i}`,type:"info",userId:"",role:"accountant",relatedOrderId:s.id,relatedInvoiceId:t.id,priority:"medium"}),$({title:"Статус заказа изменен",message:`Заказ #${s.id} изменен с "${Z(e.status)}" на "${Z(s.status)}" водителем ${i}`,type:"info",userId:"",role:"director",relatedOrderId:s.id,relatedInvoiceId:t.id,priority:"medium"}),"completed"===s.status&&($({title:"Заказ выполнен",message:`Заказ #${s.id} успешно выполнен водителем ${i} для ${s.customerName}`,type:"success",userId:"",role:"dispatcher",relatedOrderId:s.id,relatedInvoiceId:t.id,priority:"high"}),$({title:"Заказ выполнен",message:`Заказ #${s.id} успешно выполнен водителем ${i} для ${s.customerName}`,type:"success",userId:"",role:"accountant",relatedOrderId:s.id,relatedInvoiceId:t.id,priority:"high"}),$({title:"Заказ выполнен",message:`Заказ #${s.id} успешно выполнен водителем ${i} для ${s.customerName}`,type:"success",userId:"",role:"director",relatedOrderId:s.id,relatedInvoiceId:t.id,priority:"high"})),"cancelled"===s.status){const e=r.rejectionReason||"Не указана";$({title:"Заказ отменен",message:`Заказ #${s.id} отменен водителем ${i}. Причина: ${e}`,type:"warning",userId:"",role:"dispatcher",relatedOrderId:s.id,relatedInvoiceId:t.id,priority:"high"}),$({title:"Заказ отменен",message:`Заказ #${s.id} отменен водителем ${i}. Причина: ${e}`,type:"warning",userId:"",role:"accountant",relatedOrderId:s.id,relatedInvoiceId:t.id,priority:"high"}),$({title:"Заказ отменен",message:`Заказ #${s.id} отменен водителем ${i}. Причина: ${e}`,type:"warning",userId:"",role:"director",relatedOrderId:s.id,relatedInvoiceId:t.id,priority:"high"})}r.departureConfirmed&&($({title:"Водитель выехал",message:`Водитель ${i} (${a}) выехал с заказа #${s.id}`,type:"info",userId:"",role:"dispatcher",relatedOrderId:s.id,relatedInvoiceId:t.id,priority:"medium"}),$({title:"Водитель выехал",message:`Водитель ${i} (${a}) выехал с заказа #${s.id}`,type:"info",userId:"",role:"director",relatedOrderId:s.id,relatedInvoiceId:t.id,priority:"medium"})),r.arrivalConfirmed&&($({title:"Водитель прибыл",message:`Водитель ${i} прибыл к заказчику ${s.customerName} (заказ #${s.id})`,type:"info",userId:"",role:"dispatcher",relatedOrderId:s.id,relatedInvoiceId:t.id,priority:"medium"}),$({title:"Водитель прибыл",message:`Водитель ${i} прибыл к заказчику ${s.customerName} (заказ #${s.id})`,type:"info",userId:"",role:"director",relatedOrderId:s.id,relatedInvoiceId:t.id,priority:"medium"}))},W=s=>{if(!s.driverActions)return e.jsx(n,{className:"w-4 h-4 text-mono-400"});switch(s.driverActions.invoiceStatus){case"delivered":return e.jsx(c,{className:"w-4 h-4 text-mono-600"});case"rejected":return e.jsx(m,{className:"w-4 h-4 text-mono-600"});case"completed":return e.jsx(c,{className:"w-4 h-4 text-black"});default:return e.jsx(n,{className:"w-4 h-4 text-yellow-500"})}},X=e=>{if(!e.driverActions)return"В ожидании";switch(e.driverActions.invoiceStatus){case"delivered":return"Подписали";case"rejected":return"Не подписали";case"completed":return"Завершено";default:return"В процессе"}},Z=e=>({pending:"Ожидает",confirmed:"Подтвержден",ready:"Готов к доставке",in_production:"В производстве",completed:"Выполнен",cancelled:"Отменен"}[e]||e);return F&&S?e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6 p-4 bg-mono-50 border-t border-mono-200 text-center",children:e.jsxs("button",{onClick:()=>P(!1),className:"inline-flex items-center px-6 py-3 bg-black text-white rounded-lg hover:bg-black transition-colors",children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"Назад к списку"]})}),e.jsx(d,{invoice:S})]}):e.jsxs(r,{title:"Мои накладные",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-mono-50 border border-mono-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(u,{className:"w-5 h-5 text-black"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-black",children:Y?.fullName||"Водитель"}),e.jsx("p",{className:"text-black",children:"Накладные для доставки"})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(v,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-mono-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Поиск по номеру накладной, объекту или клиенту...",value:D,onChange:e=>O(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-transparent"})]})}),e.jsxs("button",{onClick:()=>G(!z),className:"flex items-center px-4 py-2 text-mono-600 border border-mono-300 rounded-lg hover:bg-mono-50",children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"Фильтры"]}),e.jsx(a,{viewMode:L,onViewModeChange:R})]}),z&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-mono-200",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-mono-700 mb-1",children:"Дата с"}),e.jsx("input",{type:"date",value:M,onChange:e=>_(e.target.value),className:"w-full px-3 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-mono-700 mb-1",children:"Дата по"}),e.jsx("input",{type:"date",value:E,onChange:e=>U(e.target.value),className:"w-full px-3 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsx("button",{onClick:()=>{O(""),_(""),U("")},className:"px-4 py-2 text-mono-600 hover:text-mono-800",children:"Очистить фильтры"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(o,{className:"w-8 h-8 text-black"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-mono-500",children:"Всего накладных"}),e.jsx("p",{className:"text-2xl font-bold text-mono-900",children:q.length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{className:"w-8 h-8 text-mono-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-mono-500",children:"На сегодня"}),e.jsx("p",{className:"text-2xl font-bold text-mono-900",children:q.filter(e=>{const s=(new Date).toDateString();return new Date(e.invoiceDate).toDateString()===s}).length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(n,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-mono-500",children:"Отфильтровано"}),e.jsx("p",{className:"text-2xl font-bold text-mono-900",children:B.length})]})]})})]}),0===B.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(o,{className:"w-16 h-16 text-mono-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-mono-900 mb-2",children:"Накладных не найдено"}),e.jsx("p",{className:"text-mono-500",children:D||M||E?"Попробуйте изменить фильтры поиска":"Для вас пока не созданы накладные"})]}):e.jsx(e.Fragment,{children:"list"===L?e.jsx("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-mono-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Номер накладной"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Дата"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Клиент"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Объект доставки"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Транспорт"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Адрес"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Статус"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Действия"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:B.map(s=>e.jsxs("tr",{className:"hover:bg-mono-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-mono-900",children:s.invoiceNumber}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-mono-500",children:new Date(s.invoiceDate).toLocaleDateString("ru-RU")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-mono-500",children:s.customerName}),e.jsx("td",{className:"px-6 py-4 text-sm text-mono-500",children:e.jsx("div",{className:"max-w-xs truncate",children:s.delivery.deliveryObject})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-mono-500",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(N,{className:"w-4 h-4 mr-1"}),s.delivery.vehicleNumber]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-mono-500",children:e.jsx("div",{className:"max-w-xs truncate",children:s.delivery.deliveryAddress||"Не указан"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[W(s),e.jsx("span",{className:("delivered"===s.driverActions?.invoiceStatus||s.driverActions,"text-mono-600"),children:X(s)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>J(s),className:"text-black hover:text-black",title:"Действия водителя",children:e.jsx(b,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>H(s),className:"text-mono-600 hover:text-green-900",title:"Просмотреть",children:e.jsx(g,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{A(s),P(!0)},className:"text-mono-600 hover:text-mono-900",title:"Печать",children:e.jsx(f,{className:"w-4 h-4"})})]})})]},s.id))})]})})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:B.map(s=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-mono-900",children:s.invoiceNumber}),e.jsx("p",{className:"text-sm text-mono-500",children:new Date(s.invoiceDate).toLocaleDateString("ru-RU")})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>J(s),className:"p-2 text-black hover:bg-mono-50 rounded-lg",title:"Действия водителя",children:e.jsx(b,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>H(s),className:"p-2 text-mono-600 hover:bg-green-50 rounded-lg",title:"Просмотреть",children:e.jsx(g,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{A(s),P(!0)},className:"p-2 text-mono-600 hover:bg-mono-50 rounded-lg",title:"Печать",children:e.jsx(f,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(u,{className:"w-4 h-4 text-mono-400 mt-0.5 mr-2"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-mono-900",children:"Клиент"}),e.jsx("p",{className:"text-sm text-mono-500",children:s.customerName})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(y,{className:"w-4 h-4 text-mono-400 mt-0.5 mr-2"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-mono-900",children:"Объект"}),e.jsx("p",{className:"text-sm text-mono-500",children:s.delivery.deliveryObject})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(N,{className:"w-4 h-4 text-mono-400 mt-0.5 mr-2"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-mono-900",children:"Транспорт"}),e.jsx("p",{className:"text-sm text-mono-500",children:s.delivery.vehicleNumber})]})]}),s.delivery.deliveryAddress&&e.jsxs("div",{className:"flex items-start",children:[e.jsx(y,{className:"w-4 h-4 text-mono-400 mt-0.5 mr-2"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-mono-900",children:"Адрес"}),e.jsx("p",{className:"text-sm text-mono-500",children:s.delivery.deliveryAddress})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-4 h-4 mt-0.5 mr-2 flex-shrink-0",children:W(s)}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-mono-900",children:"Статус"}),e.jsx("p",{className:"text-sm "+("delivered"===s.driverActions?.invoiceStatus||s.driverActions,"text-mono-600"),children:X(s)})]})]})]})]},s.id))})})]}),S&&e.jsx(I,{invoice:S,isOpen:T,onClose:()=>V(!1),onSave:e=>{if(S){const s={...S,driverActions:e,updatedAt:(new Date).toISOString()};x(e=>e.map(e=>e.id===S.id?s:e)),K(S,e);const t=S.orderId?" Статус заказа обновлен!":"";alert(`Действия водителя сохранены!${t}`)}}})]})};export{k as default};
