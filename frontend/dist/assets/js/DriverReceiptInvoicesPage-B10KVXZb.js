import{u as e,a as s,U as t,j as i,P as l}from"./index-DssK2aQr.js";import{r as a}from"./vendor-CPG67Noa.js";import{M as n}from"./Modal-_SIwUgx5.js";import{R as r,a as o}from"./ReceiptInvoicePrint-BKjFFOGi.js";import{T as c,Q as d,F as m,e as x,D as h,N as u,O as p,a as j,V as N,i as f}from"./ui-DT0cN5GG.js";import"./utils-CHM7ATol.js";import"./forms-BH-hazHY.js";function v(){const{user:v}=e(),[g,b]=s("receiptInvoices",[]),[w,y]=a.useState(""),[k,S]=a.useState("all"),[D,C]=a.useState(!1),[B,O]=a.useState(null),[W,$]=a.useState(null),[I,M]=a.useState(null),R=g.filter(e=>{const s=e.createdBy===v?.id,t=e.invoiceNumber.toLowerCase().includes(w.toLowerCase()),i="all"===k||e.status===k;return s&&t&&i}),A=g.filter(e=>e.createdBy===v?.id),z={total:A.length,drafts:A.filter(e=>"draft"===e.status).length,completed:A.filter(e=>"completed"===e.status).length,today:A.filter(e=>(new Date).toDateString()===new Date(e.invoiceDate).toDateString()).length},L=()=>{O(null),C(!0)},P=e=>new Date(e).toLocaleDateString("ru-RU"),U=e=>{switch(e){case"draft":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-mono-100 text-green-800";default:return"bg-mono-100 text-mono-800"}},V=e=>{switch(e){case"draft":return"Черновик";case"completed":return"Завершена";default:return"Неизвестно"}};return v?.role!==t.DRIVER?i.jsx(l,{title:"Доступ ограничен",children:i.jsx("div",{className:"flex items-center justify-center h-64",children:i.jsxs("div",{className:"text-center",children:[i.jsx(c,{className:"h-12 w-12 text-mono-400 mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-medium text-mono-900 mb-2",children:"Доступ ограничен"}),i.jsx("p",{className:"text-mono-500",children:"Эта страница доступна только водителям"})]})})}):i.jsxs(l,{title:"Приходные накладные",children:[i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[i.jsxs("div",{children:[i.jsxs("h1",{className:"text-2xl font-bold text-mono-900 flex items-center",children:[i.jsx(c,{className:"h-8 w-8 text-black mr-3"}),"Мои приходные накладные"]}),i.jsx("p",{className:"text-mono-600 mt-1",children:"Управление вашими приходными накладными"})]}),i.jsxs("button",{onClick:L,className:"mt-4 sm:mt-0 inline-flex items-center px-4 py-2 bg-black text-white rounded-lg hover:bg-black transition-colors duration-200",children:[i.jsx(d,{className:"h-5 w-5 mr-2"}),"Создать накладную"]})]}),i.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[i.jsx("div",{className:"bg-white p-4 rounded-lg border border-mono-200",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx(m,{className:"h-8 w-8 text-black"}),i.jsxs("div",{className:"ml-3",children:[i.jsx("p",{className:"text-sm font-medium text-mono-500",children:"Мои накладные"}),i.jsx("p",{className:"text-2xl font-bold text-mono-900",children:z.total})]})]})}),i.jsx("div",{className:"bg-white p-4 rounded-lg border border-mono-200",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx(x,{className:"h-8 w-8 text-mono-600"}),i.jsxs("div",{className:"ml-3",children:[i.jsx("p",{className:"text-sm font-medium text-mono-500",children:"Мои черновики"}),i.jsx("p",{className:"text-2xl font-bold text-mono-900",children:z.drafts})]})]})}),i.jsx("div",{className:"bg-white p-4 rounded-lg border border-mono-200",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx(h,{className:"h-8 w-8 text-mono-600"}),i.jsxs("div",{className:"ml-3",children:[i.jsx("p",{className:"text-sm font-medium text-mono-500",children:"Мои завершенные"}),i.jsx("p",{className:"text-2xl font-bold text-mono-900",children:z.completed})]})]})}),i.jsx("div",{className:"bg-white p-4 rounded-lg border border-mono-200",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx(u,{className:"h-8 w-8 text-purple-600"}),i.jsxs("div",{className:"ml-3",children:[i.jsx("p",{className:"text-sm font-medium text-mono-500",children:"Мои сегодня"}),i.jsx("p",{className:"text-2xl font-bold text-mono-900",children:z.today})]})]})})]}),i.jsx("div",{className:"bg-white p-4 rounded-lg border border-mono-200",children:i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[i.jsx("div",{className:"flex-1",children:i.jsxs("div",{className:"relative",children:[i.jsx(p,{className:"h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-mono-400"}),i.jsx("input",{type:"text",placeholder:"Поиск по номеру накладной...",value:w,onChange:e=>y(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-mono-500"})]})}),i.jsx("div",{className:"flex gap-2",children:i.jsxs("select",{value:k,onChange:e=>S(e.target.value),className:"px-3 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-mono-500 focus:border-mono-500",children:[i.jsx("option",{value:"all",children:"Все статусы"}),i.jsx("option",{value:"draft",children:"Черновики"}),i.jsx("option",{value:"completed",children:"Завершенные"})]})})]})}),i.jsx("div",{className:"bg-white rounded-lg border border-mono-200 overflow-hidden",children:0===R.length?i.jsxs("div",{className:"text-center py-12",children:[i.jsx(m,{className:"h-12 w-12 text-mono-400 mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-medium text-mono-900 mb-2",children:"Накладные не найдены"}),i.jsx("p",{className:"text-mono-500 mb-4",children:w||"all"!==k?"Попробуйте изменить фильтры поиска":"У вас пока нет приходных накладных. Создайте первую!"}),!w&&"all"===k&&i.jsxs("button",{onClick:L,className:"inline-flex items-center px-4 py-2 bg-black text-white rounded-lg hover:bg-black transition-colors duration-200",children:[i.jsx(d,{className:"h-5 w-5 mr-2"}),"Создать накладную"]})]}):i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[i.jsx("thead",{className:"bg-mono-50",children:i.jsxs("tr",{children:[i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Номер накладной"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Дата"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Склад"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Позиций"}),i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Статус"}),i.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Действия"})]})}),i.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:R.map(e=>i.jsxs("tr",{className:"hover:bg-mono-50",children:[i.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:i.jsx("div",{className:"text-sm font-medium text-mono-900",children:e.invoiceNumber})}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-mono-500",children:P(e.invoiceDate)}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-mono-500",children:e.warehouse}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-mono-500",children:e.items.length}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:i.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${U(e.status)}`,children:V(e.status)})}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:i.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[i.jsx("button",{onClick:()=>(e=>{$(e)})(e),className:"text-black hover:text-black",title:"Просмотр",children:i.jsx(j,{className:"h-4 w-4"})}),i.jsx("button",{onClick:()=>(e=>{O(e),C(!0)})(e),className:"text-mono-600 hover:text-green-900",title:"Редактировать",children:i.jsx(N,{className:"h-4 w-4"})}),i.jsx("button",{onClick:()=>(e=>{M(e)})(e),className:"text-purple-600 hover:text-purple-900",title:"Печать",children:i.jsx(m,{className:"h-4 w-4"})}),i.jsx("button",{onClick:()=>(e=>{confirm(`Удалить накладную ${e.invoiceNumber}?`)&&b(s=>s.filter(s=>s.id!==e.id))})(e),className:"text-mono-600 hover:text-red-900",title:"Удалить",children:i.jsx(f,{className:"h-4 w-4"})})]})})]},e.id))})]})})})]}),i.jsx(n,{isOpen:D,onClose:()=>{C(!1),O(null)},title:B?"Редактировать накладную":"Создать приходную накладную",children:i.jsx(r,{isOpen:D,onClose:()=>{C(!1),O(null)},onSave:e=>{if(B)b(s=>s.map(s=>s.id===B.id?{...s,invoiceNumber:e.invoiceNumber,invoiceDate:e.invoiceDate,warehouse:e.warehouse,seal:e.seal,receivedBy:e.receivedBy,issuedBy:e.issuedBy,items:e.items.map((e,s)=>({...e,id:B.items[s]?.id||Date.now().toString()+Math.random().toString(36).substr(2,9)})),updatedAt:(new Date).toISOString()}:s));else{const s={id:Date.now().toString()+Math.random().toString(36).substr(2,9),invoiceNumber:e.invoiceNumber,invoiceDate:e.invoiceDate,warehouse:e.warehouse,seal:e.seal,receivedBy:e.receivedBy,issuedBy:e.issuedBy,items:e.items.map(e=>({...e,id:Date.now().toString()+Math.random().toString(36).substr(2,9)})),status:"draft",createdBy:v?.id||"unknown",isActive:!0,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};b(e=>[s,...e])}C(!1),O(null)},invoice:B,title:B?"Редактировать накладную":"Создать приходную накладную"})}),i.jsx(n,{isOpen:!!W,onClose:()=>$(null),title:`Просмотр накладной ${W?.invoiceNumber}`,size:"lg",children:W&&i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("span",{className:"font-medium text-mono-700",children:"Номер накладной:"}),i.jsx("p",{className:"text-mono-900",children:W.invoiceNumber})]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium text-mono-700",children:"Дата:"}),i.jsx("p",{className:"text-mono-900",children:P(W.invoiceDate)})]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium text-mono-700",children:"Склад:"}),i.jsx("p",{className:"text-mono-900",children:W.warehouse})]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium text-mono-700",children:"Статус:"}),i.jsx("p",{className:"text-mono-900",children:V(W.status)})]})]}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium text-mono-700 mb-2",children:"Позиции накладной:"}),i.jsx("div",{className:"space-y-2",children:W.items.map((e,s)=>i.jsx("div",{className:"p-3 bg-mono-50 rounded-lg",children:i.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Машина:"})," ",e.vehicleNumber]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Поставщик:"})," ",e.supplier]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Покупатель:"})," ",e.buyer]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Материал:"})," ",e.material]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Брутто:"})," ",e.bruttoWeight?`${e.bruttoWeight} кг`:"—"]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Тара:"})," ",e.taraWeight?`${e.taraWeight} кг`:"—"]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Нетто:"})," ",e.netWeight?`${e.netWeight} кг`:"—"]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Итоговый вес:"})," ",e.finalWeight?`${e.finalWeight} кг`:"—"]})]})},e.id))})]})]})}),i.jsx(n,{isOpen:!!I,onClose:()=>M(null),title:`Печать накладной ${I?.invoiceNumber}`,size:"lg",children:I&&i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("p",{className:"text-sm text-mono-600",children:"Нажмите Ctrl+P для печати или используйте кнопку печати браузера"}),i.jsxs("button",{onClick:()=>window.print(),className:"inline-flex items-center px-4 py-2 bg-black text-white rounded-lg hover:bg-black transition-colors duration-200",children:[i.jsx(m,{className:"h-4 w-4 mr-2"}),"Печать"]})]}),i.jsx(o,{invoice:I})]})})]})}export{v as default};
