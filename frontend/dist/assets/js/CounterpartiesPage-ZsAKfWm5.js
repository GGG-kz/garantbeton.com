import{j as e,u as s,a as t,P as o}from"./index-DssK2aQr.js";import{r as l}from"./vendor-CPG67Noa.js";import{M as a}from"./Modal-_SIwUgx5.js";import{Z as n,_ as r,z as i,v as m,b as c,F as d,Q as x,O as p,a3 as h,a as u,V as j,i as b}from"./ui-DT0cN5GG.js";import{V as g}from"./ViewToggle-BZCXPk9z.js";import"./utils-CHM7ATol.js";import"./forms-BH-hazHY.js";function f({isOpen:s,onClose:t,onSave:o,counterparty:x,title:p}){const[h,u]=l.useState({name:"",fullName:"",type:"client",organizationType:"legal",iin:"",bin:"",address:"",phone:"",email:"",contactPerson:"",notes:""}),[j,b]=l.useState({});l.useEffect(()=>{u(x?{name:x.name,fullName:x.fullName||"",type:x.type,organizationType:x.organizationType||"legal",iin:x.iin||"",bin:x.bin||"",address:x.address||"",phone:x.phone||"",email:x.email||"",contactPerson:x.contactPerson||"",notes:x.notes||""}:{name:"",fullName:"",type:"client",organizationType:"legal",iin:"",bin:"",address:"",phone:"",email:"",contactPerson:"",notes:""}),b({})},[x,s]);const g=(e,s)=>{u(t=>{const o={...t,[e]:s};return"organizationType"===e&&("individual"===s?o.bin="":"legal"===s&&(o.iin="")),o}),j[e]&&b(s=>({...s,[e]:""}))};return e.jsx(a,{isOpen:s,onClose:t,title:p,size:"lg",children:e.jsx("div",{className:"space-y-6",children:e.jsxs("form",{onSubmit:e=>{e.preventDefault();const s={};h.name.trim()||(s.name="Название обязательно"),h.fullName.trim()||(s.fullName="Полное наименование обязательно"),h.email&&!/\S+@\S+\.\S+/.test(h.email)&&(s.email="Неверный формат email"),Object.keys(s).length>0?b(s):(o(h),t())},className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-mono-700 mb-2",children:"Название *"}),e.jsxs("div",{className:"relative",children:[e.jsx(n,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-mono-400"}),e.jsx("input",{type:"text",id:"name",value:h.name,onChange:e=>g("name",e.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 "+(j.name?"border-red-300":"border-mono-300"),placeholder:"Краткое название"})]}),j.name&&e.jsx("p",{className:"mt-1 text-sm text-mono-600",children:j.name})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"type",className:"block text-sm font-medium text-mono-700 mb-2",children:"Тип контрагента *"}),e.jsxs("select",{id:"type",value:h.type,onChange:e=>g("type",e.target.value),className:"w-full px-4 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"client",children:"Клиент"}),e.jsx("option",{value:"supplier",children:"Поставщик"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"organizationType",className:"block text-sm font-medium text-mono-700 mb-2",children:"Тип организации *"}),e.jsxs("select",{id:"organizationType",value:h.organizationType,onChange:e=>g("organizationType",e.target.value),className:"w-full px-4 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"legal",children:"Юридическое лицо"}),e.jsx("option",{value:"individual",children:"Физическое лицо"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fullName",className:"block text-sm font-medium text-mono-700 mb-2",children:"Полное наименование *"}),e.jsx("input",{type:"text",id:"fullName",value:h.fullName,onChange:e=>g("fullName",e.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 "+(j.fullName?"border-red-300":"border-mono-300"),placeholder:"Полное наименование организации"}),j.fullName&&e.jsx("p",{className:"mt-1 text-sm text-mono-600",children:j.fullName})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:["individual"===h.organizationType&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"iin",className:"block text-sm font-medium text-mono-700 mb-2",children:"ИИН"}),e.jsx("input",{type:"text",id:"iin",value:h.iin,onChange:e=>g("iin",e.target.value),className:"w-full px-4 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Индивидуальный идентификационный номер",maxLength:12})]}),"legal"===h.organizationType&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bin",className:"block text-sm font-medium text-mono-700 mb-2",children:"БИН"}),e.jsx("input",{type:"text",id:"bin",value:h.bin,onChange:e=>g("bin",e.target.value),className:"w-full px-4 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Бизнес-идентификационный номер",maxLength:12})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"address",className:"block text-sm font-medium text-mono-700 mb-2",children:"Адрес"}),e.jsxs("div",{className:"relative",children:[e.jsx(r,{className:"absolute left-3 top-3 h-4 w-4 text-mono-400"}),e.jsx("input",{type:"text",id:"address",value:h.address,onChange:e=>g("address",e.target.value),className:"w-full pl-10 pr-4 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Адрес организации"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-mono-700 mb-2",children:"Телефон"}),e.jsxs("div",{className:"relative",children:[e.jsx(i,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-mono-400"}),e.jsx("input",{type:"tel",id:"phone",value:h.phone,onChange:e=>g("phone",e.target.value),className:"w-full pl-10 pr-4 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"+7 (XXX) XXX-XX-XX"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-mono-700 mb-2",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(m,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-mono-400"}),e.jsx("input",{type:"email",id:"email",value:h.email,onChange:e=>g("email",e.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 "+(j.email?"border-red-300":"border-mono-300"),placeholder:"email@example.com"})]}),j.email&&e.jsx("p",{className:"mt-1 text-sm text-mono-600",children:j.email})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"contactPerson",className:"block text-sm font-medium text-mono-700 mb-2",children:"Контактное лицо"}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-mono-400"}),e.jsx("input",{type:"text",id:"contactPerson",value:h.contactPerson,onChange:e=>g("contactPerson",e.target.value),className:"w-full pl-10 pr-4 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"ФИО контактного лица"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-mono-700 mb-2",children:"Заметки"}),e.jsxs("div",{className:"relative",children:[e.jsx(d,{className:"absolute left-3 top-3 h-4 w-4 text-mono-400"}),e.jsx("textarea",{id:"notes",value:h.notes,onChange:e=>g("notes",e.target.value),rows:3,className:"w-full pl-10 pr-4 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Дополнительная информация"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t border-mono-200",children:[e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-mono-700 bg-mono-100 hover:bg-mono-200 rounded-lg transition-colors duration-200",children:"Отмена"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors duration-200",children:"Сохранить"})]})]})})})}const N=[];function v(){const{user:a}=s(),[d,v]=t("counterparties",N),[y,w]=t("counterpartiesViewMode","list"),[k,C]=l.useState(""),[P,S]=l.useState("all"),[A,z]=l.useState(!1),[V,I]=l.useState(null),[F,T]=l.useState(null),L=d.filter(e=>{const s=e.name.toLowerCase().includes(k.toLowerCase())||e.fullName.toLowerCase().includes(k.toLowerCase())||e.contactPerson?.toLowerCase().includes(k.toLowerCase()),t="all"===P||e.type===P;return s&&t&&e.isActive}),X=e=>"client"===e?"Клиент":"Поставщик",O=e=>"client"===e?"bg-mono-100 text-black":"bg-mono-100 text-green-800",M=e=>{I(e),z(!0)},D=e=>{T(e)},$=e=>{window.confirm("Вы уверены, что хотите удалить этого контрагента?")&&v(s=>s.map(s=>s.id===e?{...s,isActive:!1}:s))},E=e=>{const s=!e.autoApprove,t=s?"назначить VIP":"снять VIP статус";window.confirm(`Вы уверены, что хотите ${t} для "${e.name}"?`)&&v(t=>t.map(t=>t.id===e.id?{...t,autoApprove:s,updatedAt:(new Date).toISOString()}:t))};return e.jsx(o,{title:"Контрагенты",subtitle:"Управление клиентами и поставщиками",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(n,{className:"h-8 w-8 text-primary-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-mono-900",children:"Контрагенты"}),e.jsxs("p",{className:"text-mono-600",children:["Всего: ",L.length]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{viewMode:y,onViewModeChange:w}),e.jsxs("button",{onClick:()=>{I(null),z(!0)},className:"flex items-center space-x-2 px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-lg transition-colors duration-200",children:[e.jsx(x,{className:"h-4 w-4"}),e.jsx("span",{children:"Добавить контрагента"})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg border border-mono-200 p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(p,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-mono-400"}),e.jsx("input",{type:"text",placeholder:"Поиск по названию, ФИО контакта...",value:k,onChange:e=>C(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-mono-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>S("all"),className:"px-4 py-2 rounded-lg transition-colors duration-200 "+("all"===P?"bg-primary-500 text-white":"bg-mono-100 text-mono-700 hover:bg-mono-200"),children:"Все"}),e.jsx("button",{onClick:()=>S("client"),className:"px-4 py-2 rounded-lg transition-colors duration-200 "+("client"===P?"bg-mono-500 text-white":"bg-mono-100 text-mono-700 hover:bg-mono-200"),children:"Клиенты"}),e.jsx("button",{onClick:()=>S("supplier"),className:"px-4 py-2 rounded-lg transition-colors duration-200 "+("supplier"===P?"bg-mono-500 text-white":"bg-mono-100 text-mono-700 hover:bg-mono-200"),children:"Поставщики"})]})]})}),"list"===y?e.jsx("div",{className:"bg-white rounded-lg border border-mono-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-mono-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Название"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Тип"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Контактное лицо"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Телефон"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-mono-500 uppercase tracking-wider",children:"VIP"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-mono-500 uppercase tracking-wider",children:"Действия"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:L.map(s=>e.jsxs("tr",{className:"hover:bg-mono-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-mono-900",children:s.name}),s.fullName&&e.jsx("div",{className:"text-sm text-mono-500",children:s.fullName})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${O(s.type)}`,children:X(s.type)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-mono-900",children:s.contactPerson||"—"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-mono-900",children:s.phone||"—"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-mono-900",children:s.email||"—"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:s.autoApprove?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800",children:[e.jsx(h,{className:"h-3 w-3 mr-1"}),"VIP"]}):e.jsx("span",{className:"text-mono-400",children:"—"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>D(s),className:"text-black hover:text-black",title:"Просмотр",children:e.jsx(u,{className:"h-4 w-4"})}),"director"===a?.role&&e.jsx("button",{onClick:()=>E(s),className:"transition-colors duration-200 "+(s.autoApprove?"text-mono-600 hover:text-yellow-900":"text-mono-400 hover:text-mono-600"),title:s.autoApprove?"Снять VIP статус":"Назначить VIP статус",children:e.jsx(h,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>M(s),className:"text-indigo-600 hover:text-indigo-900",title:"Редактировать",children:e.jsx(j,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>$(s.id),className:"text-mono-600 hover:text-red-900",title:"Удалить",children:e.jsx(b,{className:"h-4 w-4"})})]})})]},s.id))})]})})}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:L.map(s=>e.jsxs("div",{className:"bg-white rounded-lg border border-mono-200 p-6 hover:shadow-lg transition-shadow duration-200 relative",children:[e.jsxs("div",{className:"absolute top-4 right-4 flex items-center gap-1",children:[e.jsx("button",{onClick:()=>D(s),className:"p-1 text-black hover:text-black rounded hover:bg-mono-50 transition-colors duration-200",title:"Просмотр",children:e.jsx(u,{className:"h-4 w-4"})}),"director"===a?.role&&e.jsx("button",{onClick:()=>E(s),className:"p-1 rounded transition-colors duration-200 "+(s.autoApprove?"text-mono-600 hover:text-yellow-900 hover:bg-yellow-50":"text-mono-400 hover:text-mono-600 hover:bg-mono-50"),title:s.autoApprove?"Снять VIP статус":"Назначить VIP статус",children:e.jsx(h,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>M(s),className:"p-1 text-indigo-600 hover:text-indigo-900 rounded hover:bg-indigo-50 transition-colors duration-200",title:"Редактировать",children:e.jsx(j,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>$(s.id),className:"p-1 text-mono-600 hover:text-red-900 rounded hover:bg-red-50 transition-colors duration-200",title:"Удалить",children:e.jsx(b,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"mb-4 pr-20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-mono-900 truncate",children:s.name}),s.autoApprove&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800",children:[e.jsx(h,{className:"h-3 w-3 mr-1"}),"VIP"]})]}),e.jsx("span",{className:`inline-flex px-3 py-1 text-xs font-medium rounded-full whitespace-nowrap ${O(s.type)}`,children:X(s.type)})]}),e.jsxs("div",{className:"space-y-3",children:[s.contactPerson&&e.jsxs("div",{className:"flex items-center text-sm text-mono-600",children:[e.jsx(c,{className:"h-4 w-4 text-mono-400 mr-2"}),e.jsx("span",{children:s.contactPerson})]}),s.phone&&e.jsxs("div",{className:"flex items-center text-sm text-mono-600",children:[e.jsx(i,{className:"h-4 w-4 text-mono-400 mr-2"}),e.jsx("span",{children:s.phone})]}),s.email&&e.jsxs("div",{className:"flex items-center text-sm text-mono-600",children:[e.jsx(m,{className:"h-4 w-4 text-mono-400 mr-2"}),e.jsx("span",{children:s.email})]}),s.address&&e.jsxs("div",{className:"flex items-center text-sm text-mono-600",children:[e.jsx(r,{className:"h-4 w-4 text-mono-400 mr-2"}),e.jsx("span",{children:s.address})]})]}),s.notes&&e.jsx("div",{className:"mt-4 pt-3 border-t border-mono-200",children:e.jsxs("p",{className:"text-sm text-mono-600",children:[e.jsx("strong",{children:"Примечания:"})," ",s.notes]})})]},s.id))}),0===L.length&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(n,{className:"mx-auto h-12 w-12 text-mono-400"}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-mono-900",children:k||"all"!==P?"Контрагенты не найдены":"Нет контрагентов"}),e.jsx("p",{className:"mt-2 text-mono-600",children:k||"all"!==P?"Попробуйте изменить параметры поиска":"Добавьте первого контрагента для начала работы"})]}),e.jsx(f,{isOpen:A,onClose:()=>{z(!1),I(null)},title:V?"Редактировать контрагента":"Добавить контрагента",counterparty:V,onSave:e=>{if(V)v(s=>s.map(s=>s.id===V.id?{...s,...e,updatedAt:(new Date).toISOString()}:s));else{const s={id:Date.now().toString(),...e,isActive:!0,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};v(e=>[...e,s])}z(!1),I(null)}}),F&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-mono-900",children:F.name}),e.jsx("button",{onClick:()=>T(null),className:"text-mono-400 hover:text-mono-600",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-mono-700",children:"Полное название"}),e.jsx("p",{className:"mt-1 text-sm text-mono-900",children:F.fullName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-mono-700",children:"Тип"}),e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${O(F.type)}`,children:X(F.type)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-mono-700",children:"Контактное лицо"}),e.jsx("p",{className:"mt-1 text-sm text-mono-900",children:F.contactPerson||"—"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-mono-700",children:"Телефон"}),e.jsx("p",{className:"mt-1 text-sm text-mono-900",children:F.phone||"—"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-mono-700",children:"Email"}),e.jsx("p",{className:"mt-1 text-sm text-mono-900",children:F.email||"—"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-mono-700",children:"Адрес"}),e.jsx("p",{className:"mt-1 text-sm text-mono-900",children:F.address||"—"})]}),F.notes&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-mono-700",children:"Примечания"}),e.jsx("p",{className:"mt-1 text-sm text-mono-900",children:F.notes})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:()=>T(null),className:"px-4 py-2 bg-mono-300 text-mono-700 rounded-lg hover:bg-mono-400 transition-colors duration-200",children:"Закрыть"})})]})})})]})})}export{v as default};
